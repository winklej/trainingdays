<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Challenge 04: Cognitive Services | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.8d7a09fd.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.e8a6fdbf.js" as="script"><link rel="preload" href="/trainingdays/assets/js/3.9b3cf7d1.js" as="script"><link rel="preload" href="/trainingdays/assets/js/46.d7dc415d.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.5e63eee4.js"><link rel="prefetch" href="/trainingdays/assets/js/11.52cdb15c.js"><link rel="prefetch" href="/trainingdays/assets/js/12.dd68cce1.js"><link rel="prefetch" href="/trainingdays/assets/js/13.968f15e4.js"><link rel="prefetch" href="/trainingdays/assets/js/14.6107e61f.js"><link rel="prefetch" href="/trainingdays/assets/js/15.74de6942.js"><link rel="prefetch" href="/trainingdays/assets/js/16.bf550880.js"><link rel="prefetch" href="/trainingdays/assets/js/17.25c2442d.js"><link rel="prefetch" href="/trainingdays/assets/js/18.df448a3a.js"><link rel="prefetch" href="/trainingdays/assets/js/19.57fc59b2.js"><link rel="prefetch" href="/trainingdays/assets/js/2.5f4f93ed.js"><link rel="prefetch" href="/trainingdays/assets/js/20.b16a4364.js"><link rel="prefetch" href="/trainingdays/assets/js/21.f120af84.js"><link rel="prefetch" href="/trainingdays/assets/js/22.a29f663d.js"><link rel="prefetch" href="/trainingdays/assets/js/23.2e9fa4d5.js"><link rel="prefetch" href="/trainingdays/assets/js/24.df3c97d4.js"><link rel="prefetch" href="/trainingdays/assets/js/25.d7157d1b.js"><link rel="prefetch" href="/trainingdays/assets/js/26.8b935eca.js"><link rel="prefetch" href="/trainingdays/assets/js/27.fab398a7.js"><link rel="prefetch" href="/trainingdays/assets/js/28.f45e3c7c.js"><link rel="prefetch" href="/trainingdays/assets/js/29.1ebc26ec.js"><link rel="prefetch" href="/trainingdays/assets/js/30.6728cb2f.js"><link rel="prefetch" href="/trainingdays/assets/js/31.0447b951.js"><link rel="prefetch" href="/trainingdays/assets/js/32.7ba3de54.js"><link rel="prefetch" href="/trainingdays/assets/js/33.1886053c.js"><link rel="prefetch" href="/trainingdays/assets/js/34.71397a5c.js"><link rel="prefetch" href="/trainingdays/assets/js/35.3f4903ee.js"><link rel="prefetch" href="/trainingdays/assets/js/36.ca5c6cd3.js"><link rel="prefetch" href="/trainingdays/assets/js/37.150f3aea.js"><link rel="prefetch" href="/trainingdays/assets/js/38.267b0401.js"><link rel="prefetch" href="/trainingdays/assets/js/39.b63e5745.js"><link rel="prefetch" href="/trainingdays/assets/js/4.51ff6f02.js"><link rel="prefetch" href="/trainingdays/assets/js/40.ccce5e2d.js"><link rel="prefetch" href="/trainingdays/assets/js/41.8d1a41f2.js"><link rel="prefetch" href="/trainingdays/assets/js/42.b2565944.js"><link rel="prefetch" href="/trainingdays/assets/js/43.b9bb36ce.js"><link rel="prefetch" href="/trainingdays/assets/js/44.0cb215c3.js"><link rel="prefetch" href="/trainingdays/assets/js/45.ed0b28e2.js"><link rel="prefetch" href="/trainingdays/assets/js/47.94e659f8.js"><link rel="prefetch" href="/trainingdays/assets/js/48.22da67bb.js"><link rel="prefetch" href="/trainingdays/assets/js/49.d0cc21bd.js"><link rel="prefetch" href="/trainingdays/assets/js/5.8a1a1dd9.js"><link rel="prefetch" href="/trainingdays/assets/js/50.fc76ce90.js"><link rel="prefetch" href="/trainingdays/assets/js/51.49e6933d.js"><link rel="prefetch" href="/trainingdays/assets/js/52.b3007d12.js"><link rel="prefetch" href="/trainingdays/assets/js/53.ce74ac77.js"><link rel="prefetch" href="/trainingdays/assets/js/54.0ae1433b.js"><link rel="prefetch" href="/trainingdays/assets/js/55.84f6f655.js"><link rel="prefetch" href="/trainingdays/assets/js/56.8abf9a8b.js"><link rel="prefetch" href="/trainingdays/assets/js/57.5f879cc0.js"><link rel="prefetch" href="/trainingdays/assets/js/58.143be8bb.js"><link rel="prefetch" href="/trainingdays/assets/js/59.48d8acfe.js"><link rel="prefetch" href="/trainingdays/assets/js/6.49058ca4.js"><link rel="prefetch" href="/trainingdays/assets/js/60.a173b602.js"><link rel="prefetch" href="/trainingdays/assets/js/61.04f45b6d.js"><link rel="prefetch" href="/trainingdays/assets/js/62.c3ecf647.js"><link rel="prefetch" href="/trainingdays/assets/js/63.ad717965.js"><link rel="prefetch" href="/trainingdays/assets/js/64.3e451a8e.js"><link rel="prefetch" href="/trainingdays/assets/js/65.a310d4e8.js"><link rel="prefetch" href="/trainingdays/assets/js/66.91ad5d91.js"><link rel="prefetch" href="/trainingdays/assets/js/67.bdfc270a.js"><link rel="prefetch" href="/trainingdays/assets/js/68.7805630f.js"><link rel="prefetch" href="/trainingdays/assets/js/69.9a6edb47.js"><link rel="prefetch" href="/trainingdays/assets/js/7.3ee5fb68.js"><link rel="prefetch" href="/trainingdays/assets/js/70.2e5214af.js"><link rel="prefetch" href="/trainingdays/assets/js/71.0ed1ea53.js"><link rel="prefetch" href="/trainingdays/assets/js/72.05b27471.js"><link rel="prefetch" href="/trainingdays/assets/js/73.5cd028ca.js"><link rel="prefetch" href="/trainingdays/assets/js/74.cd61fe8d.js"><link rel="prefetch" href="/trainingdays/assets/js/75.8c8f40ca.js"><link rel="prefetch" href="/trainingdays/assets/js/76.50f7afaf.js"><link rel="prefetch" href="/trainingdays/assets/js/77.a0e160e0.js"><link rel="prefetch" href="/trainingdays/assets/js/78.c8465bf5.js"><link rel="prefetch" href="/trainingdays/assets/js/79.458fd2c0.js"><link rel="prefetch" href="/trainingdays/assets/js/8.3f86f0a0.js"><link rel="prefetch" href="/trainingdays/assets/js/80.454f4426.js"><link rel="prefetch" href="/trainingdays/assets/js/81.ed2d010d.js"><link rel="prefetch" href="/trainingdays/assets/js/82.cd4bb1c0.js"><link rel="prefetch" href="/trainingdays/assets/js/83.e3b63896.js"><link rel="prefetch" href="/trainingdays/assets/js/84.af75ea47.js"><link rel="prefetch" href="/trainingdays/assets/js/85.728f265c.js"><link rel="prefetch" href="/trainingdays/assets/js/86.e93b6d39.js"><link rel="prefetch" href="/trainingdays/assets/js/87.d5748615.js"><link rel="prefetch" href="/trainingdays/assets/js/9.b9da79d5.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.8d7a09fd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" aria-current="page" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 DevOps and Monitoring</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="challenge-04-cognitive-services"><a href="#challenge-04-cognitive-services" class="header-anchor">#</a> Challenge 04: Cognitive Services</h1> <p>‚è≤Ô∏è <em>Est. time to complete: 10 min.</em> ‚è≤Ô∏è</p> <h2 id="here-is-what-you-will-learn-üéØ"><a href="#here-is-what-you-will-learn-üéØ" class="header-anchor">#</a> Here is what you will learn üéØ</h2> <p>In this challenge you will learn how to:</p> <ul><li>create an Azure Cognitive Service</li> <li>analyze sentiment and opinions using the Azure Cognitive Service for Language</li> <li>use a contrainerized Cognitive Service</li> <li>make an API call from a Node.js application</li></ul> <h2 id="table-of-contents"><a href="#table-of-contents" class="header-anchor">#</a> Table Of Contents</h2> <ol><li><a href="#what-are-azure-cognitive-services">What are Azure Cognitive Services?</a></li> <li><a href="#create-a-cognitive-service">Create a Cognitive Service</a></li> <li><a href="#analyze-sentiment-and-opinions">Analyze Sentiment</a></li> <li><a href="#(optional)-containerize-the-cognitive-service">(OPTIONAL) Containerize the Cognitive Service</a></li> <li><a href="#(optional)-use-azure-text-analytics-in-a-web-application">(OPTIONAL) Use Azure Text Analytics in a Web Application</a></li> <li><a href="#(optional)-use-postman-to-understand-all-features">(OPTIONAL) Use Postman to understand all features</a></li> <li><a href="#cleanup">Cleanup</a></li></ol> <h2 id="what-are-azure-cognitive-services"><a href="#what-are-azure-cognitive-services" class="header-anchor">#</a> What are Azure Cognitive Services?</h2> <p>Azure Cognitive Services:</p> <ul><li>are APIs, SDKs and services available to help developers build intelligent applications without having direct Artificial Intelligence (AI), data science skills or knowledge.</li> <li>enable developers to easily add cognitive features into their applications.</li></ul> <p>The goal of Azure Cognitive Services is to help developers create applications that can see, hear, speak, understand and even begin to reason.
These services can be categorized into six main pillars - <em>Vision</em>, <em>Speech</em>, <em>Language</em>, <em>Web Search</em>, <em>Decision</em> and <em>Open AI</em>.</p> <p>We offer a separate training that will go into greater depth also covering Azure Machine Learning Services and MLOps - reach out to us if you are interested. Today we will focus on one Feature of the Azure Cognitive Service for Language to consolidate the understanding of these services. The Azure Cognitive Service for Language has many more features that work very similarly and other Azure Cognitive Services work with the same concepts.</p> <table><thead><tr><th style="text-align:left;">Service Name</th> <th style="text-align:left;">Service Description</th> <th style="text-align:left;">Feature Name</th> <th style="text-align:left;">Feature Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><a href="https://docs.microsoft.com/en-us/azure/cognitive-services/language-service/overview" target="_blank" rel="noopener noreferrer">Azure Cognitive Service for Language<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">Provide natural language processing over raw text for understanding and analyzing text.</td> <td style="text-align:left;"><a href="https://docs.microsoft.com/en-us/azure/cognitive-services/language-service/overview" target="_blank" rel="noopener noreferrer">Sentiment Analysis and Opinion Mining<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">Extract the sentiment of text and associate positive and negative sentiment with specific aspects of the text.</td></tr></tbody></table> <h2 id="create-a-cognitive-service"><a href="#create-a-cognitive-service" class="header-anchor">#</a> Create a Cognitive Service</h2> <p>We are going to start off by creating an Azure Cognitive Service using the Azure CLI.</p> <ol><li>First we will create a new resource group. Enter the following in your terminal:<div class="language-shell extra-class"><pre class="language-shell"><code>az group create <span class="token parameter variable">-n</span> rg-azdc-cognitive <span class="token parameter variable">-l</span> westeurope
</code></pre></div></li> <li>When creating the Cognitive Service itself you have two choices. You can either create a multi-service resource or a single-service resource. The multi-service resource gives you access to multiple Azure Cognitive Services with a single key and endpoint. The Single-service resource will allow you to access a single Azure Cognitive Service with a unique key and endpoint.
Since we will only use the Cognitive Service for Language in this challenge we will create a single-service resource.<div class="language-shell extra-class"><pre class="language-shell"><code>az cognitiveservices account create <span class="token parameter variable">--name</span> cog-textanalytics-westeurope-001 --resource-group rg-azdc-cognitive <span class="token parameter variable">--kind</span> TextAnalytics <span class="token parameter variable">--sku</span> S <span class="token parameter variable">--location</span> westeurope <span class="token parameter variable">--yes</span>
</code></pre></div></li></ol> <h2 id="analyze-sentiment-and-opinions"><a href="#analyze-sentiment-and-opinions" class="header-anchor">#</a> Analyze Sentiment and Opinions</h2> <p>We are going to create a simple node application to test the service.</p> <ol><li><p>Create a new folder on your local machine, where the project will reside later on. Name it <code>TextAnalytics</code>.</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> TextAnalytics
</code></pre></div><p>Navigate to the newly created Folder.</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> TextAnalytics
</code></pre></div></li> <li><p>Create a node application with a package.json file. Accept all defaults.</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> init
</code></pre></div><p>And install the client library</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> @azure/ai-text-analytics@5.1.0
</code></pre></div><p>Now open the application in VS Code.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>code <span class="token builtin class-name">.</span>
</code></pre></div></li> <li><p>Create a new <code>sentiment.js</code> file and add the following code:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> TextAnalyticsClient<span class="token punctuation">,</span> AzureKeyCredential <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@azure/ai-text-analytics&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token string">'&lt;API-KEY&gt;'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> endpoint <span class="token operator">=</span> <span class="token string">'https://westeurope.api.cognitive.microsoft.com/'</span><span class="token punctuation">;</span>
<span class="token comment">// Authenticate the client with your key and endpoint</span>
<span class="token keyword">const</span> textAnalyticsClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextAnalyticsClient</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span>  <span class="token keyword">new</span> <span class="token class-name">AzureKeyCredential</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Example method for detecting sentiment in text</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sentimentAnalysis</span><span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">const</span> sentimentInput <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;I had the best day of my life. I wish you were there with me.&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> sentimentResult <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">analyzeSentiment</span><span class="token punctuation">(</span>sentimentInput<span class="token punctuation">)</span><span class="token punctuation">;</span>

    sentimentResult<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">document</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>document<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\tDocument Sentiment: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>document<span class="token punctuation">.</span>sentiment<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\tDocument Scores:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\t\tPositive: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>document<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">.</span>positive<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> \tNegative: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>document<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">.</span>negative<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> \tNeutral: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>document<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">.</span>neutral<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\tSentences Sentiment(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>document<span class="token punctuation">.</span>sentences<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">):</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>sentences<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">sentence</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\t\tSentence sentiment: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sentence<span class="token punctuation">.</span>sentiment<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\t\tSentences Scores:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\t\tPositive: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sentence<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">.</span>positive<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> \tNegative: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sentence<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">.</span>negative<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> \tNeutral: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sentence<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">.</span>neutral<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">sentimentAnalysis</span><span class="token punctuation">(</span>textAnalyticsClient<span class="token punctuation">)</span>

<span class="token comment">// Example method for detecting opinions in text </span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sentimentAnalysisWithOpinionMining</span><span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token keyword">const</span> sentimentInput <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;The food and service were unacceptable, but the concierge were nice&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">language</span><span class="token operator">:</span> <span class="token string">&quot;en&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">analyzeSentiment</span><span class="token punctuation">(</span>sentimentInput<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">includeOpinionMining</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> results<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> results<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- Document </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\tDocument text: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sentimentInput<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\tOverall Sentiment: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>sentiment<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\tSentiment confidence scores:&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\tSentences&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span> sentiment<span class="token punctuation">,</span> confidenceScores<span class="token punctuation">,</span> opinions <span class="token punctuation">}</span> <span class="token keyword">of</span> result<span class="token punctuation">.</span>sentences<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\t- Sentence sentiment: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sentiment<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\t  Confidence scores:&quot;</span><span class="token punctuation">,</span> confidenceScores<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\t  Mined opinions&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span> target<span class="token punctuation">,</span> assessments <span class="token punctuation">}</span> <span class="token keyword">of</span> opinions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\t\t- Target text: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\t\t  Target sentiment: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">.</span>sentiment<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\t\t  Target confidence scores:&quot;</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\t\t  Target assessments&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span> text<span class="token punctuation">,</span> sentiment <span class="token punctuation">}</span> <span class="token keyword">of</span> assessments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\t\t\t- Text: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\t\t\t  Sentiment: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sentiment<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\tError: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">sentimentAnalysisWithOpinionMining</span><span class="token punctuation">(</span>textAnalyticsClient<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>Before you can run the code you need to add your Azure Text Analytics Service key in it. You can obtain this information by running the following command:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>az cognitiveservices account keys list <span class="token parameter variable">--name</span> cog-textanalytics-westeurope-001 --resource-group rg-azdc-cognitive
</code></pre></div></li> <li><p>Save the changes and run the code.</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">node</span> sentiment.js
</code></pre></div></li></ol> <p>The result is measured as positive if it's scored closer to 1.0 and negative if it's scored closer to 0.0. The sentiment scores are also associated with different targets within the given text.
This result is returned in JSON, as you can see here:</p> <div class="language-json extra-class"><pre class="language-json"><code>ID<span class="token operator">:</span> <span class="token number">0</span>
        Document Sentiment<span class="token operator">:</span> positive
        Document Scores<span class="token operator">:</span>
                Positive<span class="token operator">:</span> <span class="token number">1.00</span>  Negative<span class="token operator">:</span> <span class="token number">0.00</span>  Neutral<span class="token operator">:</span> <span class="token number">0.00</span>
        Sentences Sentiment(<span class="token number">2</span>)<span class="token operator">:</span>
                Sentence sentiment<span class="token operator">:</span> positive
                Sentences Scores<span class="token operator">:</span>
                Positive<span class="token operator">:</span> <span class="token number">1.00</span>  Negative<span class="token operator">:</span> <span class="token number">0.00</span>  Neutral<span class="token operator">:</span> <span class="token number">0.00</span>
                Sentence sentiment<span class="token operator">:</span> neutral
                Sentences Scores<span class="token operator">:</span>
                Positive<span class="token operator">:</span> <span class="token number">0.21</span>  Negative<span class="token operator">:</span> <span class="token number">0.02</span>  Neutral<span class="token operator">:</span> <span class="token number">0.77</span>

- Document <span class="token number">0</span>
        Document text<span class="token operator">:</span> The food and service were unacceptable<span class="token punctuation">,</span> but the concierge were nice
        Overall Sentiment<span class="token operator">:</span> positive
        Sentiment confidence scores<span class="token operator">:</span> <span class="token punctuation">{</span> positive<span class="token operator">:</span> <span class="token number">0.84</span><span class="token punctuation">,</span> neutral<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> negative<span class="token operator">:</span> <span class="token number">0.16</span> <span class="token punctuation">}</span>
        Sentences
        - Sentence sentiment<span class="token operator">:</span> positive
          Confidence scores<span class="token operator">:</span> <span class="token punctuation">{</span> positive<span class="token operator">:</span> <span class="token number">0.84</span><span class="token punctuation">,</span> neutral<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> negative<span class="token operator">:</span> <span class="token number">0.16</span> <span class="token punctuation">}</span>
          Mined opinions
                - Target text<span class="token operator">:</span> food
                  Target sentiment<span class="token operator">:</span> negative
                  Target confidence scores<span class="token operator">:</span> <span class="token punctuation">{</span> positive<span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> negative<span class="token operator">:</span> <span class="token number">0.99</span> <span class="token punctuation">}</span>
                  Target assessments
                        - Text<span class="token operator">:</span> unacceptable
                          Sentiment<span class="token operator">:</span> negative
                - Target text<span class="token operator">:</span> service
                  Target sentiment<span class="token operator">:</span> negative
                  Target confidence scores<span class="token operator">:</span> <span class="token punctuation">{</span> positive<span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> negative<span class="token operator">:</span> <span class="token number">0.99</span> <span class="token punctuation">}</span>
                  Target assessments
                        - Text<span class="token operator">:</span> unacceptable
                          Sentiment<span class="token operator">:</span> negative
                - Target text<span class="token operator">:</span> concierge
                  Target sentiment<span class="token operator">:</span> positive
                  Target confidence scores<span class="token operator">:</span> <span class="token punctuation">{</span> positive<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> negative<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
                  Target assessments
                        - Text<span class="token operator">:</span> nice
                          Sentiment<span class="token operator">:</span> positive
</code></pre></div><h2 id="optional-containerize-the-cognitive-service"><a href="#optional-containerize-the-cognitive-service" class="header-anchor">#</a> (OPTIONAL) Containerize the Cognitive Service</h2> <p>Most Cognitive Services can be run from a container. In this case the sentiment analysis container is available. The advantage of containerization of Cognitive Services usually lie in security or data governance requirements. This way you can run the service on your own infrastructure and only billing information will be sent against the Cognitive Service. An Azure Cognitive Service needs to reside in your Subscription to take this billing information. Since we already deployed one in the previous steps we can go ahead.
Should you not have <strong>Docker Desktop</strong> installed don't worry, this part of the challenge is optional.</p> <ol><li><p>If you have Docker Desktop installed and running download the English container:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> pull mcr.microsoft.com/azure-cognitive-services/textanalytics/sentiment:3.0-en
</code></pre></div></li> <li><p>Before we can run the container we need to get the API key again.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>az cognitiveservices account keys list <span class="token parameter variable">--name</span> cog-textanalytics-westeurope-001 --resource-group rg-azdc-cognitive
</code></pre></div></li> <li><p>This information needs to be added to the <code>docker run</code> command:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">-it</span> <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000 <span class="token parameter variable">--memory</span> 8g <span class="token parameter variable">--cpus</span> <span class="token number">1</span> mcr.microsoft.com/azure-cognitive-services/textanalytics/sentiment:3.0-en <span class="token assign-left variable">Eula</span><span class="token operator">=</span>accept <span class="token assign-left variable">Billing</span><span class="token operator">=</span>https://westeurope.api.cognitive.microsoft.com/ <span class="token assign-left variable">ApiKey</span><span class="token operator">=</span><span class="token punctuation">{</span>API_KEY<span class="token punctuation">}</span>

</code></pre></div></li> <li><p>The prediction endpoint APIs will be available under <code>http://localhost:5000</code> after about a minute. You can easily try out different options by navigating to the full documentation of the endpoints:
<code>http://localhost:5000/swagger</code></p></li> <li><p>For example select the <code>POST /text/analytics/v3.0/sentiment</code>, press <code>Try it out</code> and add the same sentence as before to the body:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;documents&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;language&quot;</span><span class="token operator">:</span> <span class="token string">&quot;en&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;The food and service were unacceptable, but the concierge were nice.&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Beneath select <code>application/json</code> for the <code>Parameter content type</code>. Press <code>Execute</code>. You should get a server response with the code 200 and the sentiment in the response body.
Try out more options if you feel like it.</p></li></ol> <h2 id="optional-use-azure-text-analytics-in-a-web-application"><a href="#optional-use-azure-text-analytics-in-a-web-application" class="header-anchor">#</a> (OPTIONAL) Use Azure Text Analytics in a Web Application</h2> <p>In the next part we integrate the API into a Node.js web app. This is optional.</p> <ol><li><p>First create a simple Node.js app using the Express Generator. This should be installed by default with Node.js and NPM, otherwise it will install the package during the process. Navigate to a directory you want the folder to be in.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>npx express-generator TextAnalyticsApp <span class="token parameter variable">--view</span> pug
</code></pre></div></li> <li><p>Navigate into the project folder:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> TextAnalyticsApp
</code></pre></div></li> <li><p>Open the code of the application in VS Code.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>code <span class="token builtin class-name">.</span>
</code></pre></div><p>Navigate to <code>views/index.pug</code> and replace the code with the following:</p> <div class="language-HTML extra-class"><pre class="language-html"><code>extends layout

block content
    h1 Azure Cognitive Service
    p Get the Sentiment of the Sentences you type in using the Azure Cognitive Service.
    form(action='/', method='POST') 
        input(type=&quot;text&quot;, name=&quot;sentence&quot;, placeholder=&quot;I really like the new XBox but I just don't have enough time to use it.&quot;)
        input(type=&quot;submit&quot;, value=&quot;Analyze&quot;)
    
    div(style=&quot;width: 100%&quot;)
        p= sentence 
        div(style=`background-color: red; width:${negative1}`)
            p(style=&quot;color: white;&quot;)= negative1
        div(style=`background-color: orange; width:${neutral1}`)
            p(style=&quot;color: white;&quot;)= neutral1
        div(style=`background-color: green; width:${positive1}`)
            p(style=&quot;color: white;&quot;)= positive1
</code></pre></div><p>Watch out for the indentation since the application will through an error otherwise.</p></li> <li><p>Finally replace the code in the <code>routes/index.js</code> file with the following Node.js code:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> apikey <span class="token operator">=</span> <span class="token string">'&lt;Text Analytics API Key&gt;'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> endpoint <span class="token operator">=</span> <span class="token string">'https://westeurope.api.cognitive.microsoft.com/'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> analyzetext <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> TextAnalyticsClient<span class="token punctuation">,</span> AzureKeyCredential <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@azure/ai-text-analytics&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Azure Text Analytics Service'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>sentence<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sentencetext <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>sentence<span class="token punctuation">;</span>
<span class="token function">analyze</span><span class="token punctuation">(</span>sentencetext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">analyze</span><span class="token punctuation">(</span><span class="token parameter">sentencetext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    analyzetext <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    analyzetext<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sentencetext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextAnalyticsClient</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AzureKeyCredential</span><span class="token punctuation">(</span>apikey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">analyzeSentiment</span><span class="token punctuation">(</span>analyzetext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> results<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> results<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> negative1 <span class="token operator">=</span> result<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">.</span>negative <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> neutral1 <span class="token operator">=</span> result<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">.</span>neutral <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> positive1 <span class="token operator">=</span> result<span class="token punctuation">.</span>confidenceScores<span class="token punctuation">.</span>positive <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sentence</span><span class="token operator">:</span> <span class="token string">&quot;Sentiment of the following sentence: &quot;</span> <span class="token operator">+</span> sentencetext<span class="token punctuation">,</span> <span class="token literal-property property">positive1</span><span class="token operator">:</span> positive1 <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">neutral1</span><span class="token operator">:</span> neutral1 <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">negative1</span><span class="token operator">:</span> negative1 <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>Replace the <code>&lt;Text Analytics API Key&gt;</code> in line 1 of the index.js file awith the API Key of your Cognitive Service.
If you need to get it again:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>az cognitiveservices account keys list <span class="token parameter variable">--name</span> cog-textanalytics-westeurope-001 --resource-group rg-azdc-cognitive
</code></pre></div><p>Save the changes.</p></li> <li><p>Some additional NPM packages need to be installed:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div><p>If not already installed make sure to install the text analytics package:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> @azure/ai-text-analytics
</code></pre></div></li> <li><p>Finally you can start the application:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> start
</code></pre></div><p>You can have a look at it in your browser <code>http://localhost:3000</code>.</p></li></ol> <h2 id="optional-use-postman-to-understand-all-features"><a href="#optional-use-postman-to-understand-all-features" class="header-anchor">#</a> (OPTIONAL) Use Postman to understand all features</h2> <p>As shown before the Azure Cognitive Services consist of a wide range of REST APIs. There are multiple options to explore these APIs. Let's have a look at two prominent ones.</p> <h3 id="option-1-microsoft-test-console"><a href="#option-1-microsoft-test-console" class="header-anchor">#</a> Option 1: Microsoft Test Console</h3> <p>On <a href="https://westeurope.dev.cognitive.microsoft.com/docs/services/" target="_blank" rel="noopener noreferrer">this website<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Microsoft offers a detailed description of the Azure Cognitive Services and the APIs that can be used.</p> <p><a href="https://westeurope.dev.cognitive.microsoft.com/docs/services/TextAnalytics-v3-1/operations/sentiment" target="_blank" rel="noopener noreferrer">Here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a detailed overview of the <strong>Text Analytics API (v3.1)</strong> and its <strong>Sentiment</strong> POST request. This shows all the details, the request URL, parameters, headers, body and what responses will be returned.</p> <p>Try out the <a href="https://westeurope.dev.cognitive.microsoft.com/docs/services/TextAnalytics-v3-1/operations/Sentiment/console" target="_blank" rel="noopener noreferrer">console<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with the key of the existing Azure Cognitive Service <code>cog-textanalytics-westeurope-001</code>. If you have not stored it somewhere, here is the needed command again:
<code>shell az cognitiveservices account keys list --name cog-textanalytics-westeurope-001 --resource-group rg-azdc-cognitive</code>
For Host Name choose <code>westeurope.api.cognitive.microsoft.com</code>.
Delete all Query parameters except of opinionMining and there enter <code>true</code>.
Leave the Header as is.
The Ocp-Apim-Subscription-Key is the key mentioned above.
In the Request body cou can change the language and the text you want to be analyzed.
Finally hit <code>Send</code>. In the Response content you will find the returned results.</p> <h3 id="option-2-postman"><a href="#option-2-postman" class="header-anchor">#</a> Option 2: Postman</h3> <p>You will need <a href="https://www.postman.com/downloads/" target="_blank" rel="noopener noreferrer">Postman<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for this part. Postman is an API platform which allows you to develop and test different APIs. Since the Azure Cloud Platform consists out of many APIs this tool is perfect to get a deeper understanding of its functionalities.
We have created a Postman collection for you. Upload the collection you find in the <a href="./postman">./postman</a> folder of this repository to the desktop application by selecting <code>Import</code>.</p> <p><img src="/trainingdays/assets/img/postman_collection.b8428014.png" alt="Screenshot of the Postman application showing the Collections tab and highlighting the Import button."></p> <p>Before you can send any of the requests you either need to set up an environment containing a variable named <code>api-key</code> with the value of the API Key of your Cognitive Service, or replace the <code>Ocp-Apim-Subscription-Key</code> Header value of the given request under the <code>Headers</code> tab of the request with the beforementioned key. Select the <code>POST Sentiment</code> API for a first try.</p> <p><img src="/trainingdays/assets/img/postman_environmet_variable.0a4b2868.png" alt="Screenshot of the Postman application showing the environment tab and the created api_key variable."> <img src="/trainingdays/assets/img/postman_api_key.cf4969d0.png" alt="Screenshot of the Postman application showing Sentiment request and its Headers, highlighting the Ocp-Apim-Subscription-Key."></p> <p>Now just hit <code>Send</code> right next to the request URL and you will receive a response. Feel free to change the text within the <code>Body</code> and try again.</p> <h2 id="cleanup"><a href="#cleanup" class="header-anchor">#</a> Cleanup</h2> <p>Remove the <code>rg-azdc-cognitive</code> resource group:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>az group delete <span class="token parameter variable">-n</span> rg-azdc-cognitive
</code></pre></div><p><a href="/trainingdays/day3/challenges/04-challenge-bo-1.html">‚óÄ Previous challenge</a> | <a href="/trainingdays/day3/" class="router-link-active">üîº Day 3</a> | <a href="/trainingdays/day3/challenges/06-challenge-bo-2.html">Next challenge ‚ñ∂</a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day3/challenges/05-challenge-cognitive-services.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.e8a6fdbf.js" defer></script><script src="/trainingdays/assets/js/3.9b3cf7d1.js" defer></script><script src="/trainingdays/assets/js/46.d7dc415d.js" defer></script>
  </body>
</html>
