<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>💎 Breakout 1: Add data storage services to our sample application 💎 | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.8d7a09fd.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.e8a6fdbf.js" as="script"><link rel="preload" href="/trainingdays/assets/js/3.9b3cf7d1.js" as="script"><link rel="preload" href="/trainingdays/assets/js/5.8a1a1dd9.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.5e63eee4.js"><link rel="prefetch" href="/trainingdays/assets/js/11.52cdb15c.js"><link rel="prefetch" href="/trainingdays/assets/js/12.dd68cce1.js"><link rel="prefetch" href="/trainingdays/assets/js/13.968f15e4.js"><link rel="prefetch" href="/trainingdays/assets/js/14.6107e61f.js"><link rel="prefetch" href="/trainingdays/assets/js/15.74de6942.js"><link rel="prefetch" href="/trainingdays/assets/js/16.bf550880.js"><link rel="prefetch" href="/trainingdays/assets/js/17.25c2442d.js"><link rel="prefetch" href="/trainingdays/assets/js/18.df448a3a.js"><link rel="prefetch" href="/trainingdays/assets/js/19.57fc59b2.js"><link rel="prefetch" href="/trainingdays/assets/js/2.5f4f93ed.js"><link rel="prefetch" href="/trainingdays/assets/js/20.b16a4364.js"><link rel="prefetch" href="/trainingdays/assets/js/21.f120af84.js"><link rel="prefetch" href="/trainingdays/assets/js/22.a29f663d.js"><link rel="prefetch" href="/trainingdays/assets/js/23.2e9fa4d5.js"><link rel="prefetch" href="/trainingdays/assets/js/24.df3c97d4.js"><link rel="prefetch" href="/trainingdays/assets/js/25.d7157d1b.js"><link rel="prefetch" href="/trainingdays/assets/js/26.8b935eca.js"><link rel="prefetch" href="/trainingdays/assets/js/27.fab398a7.js"><link rel="prefetch" href="/trainingdays/assets/js/28.f45e3c7c.js"><link rel="prefetch" href="/trainingdays/assets/js/29.1ebc26ec.js"><link rel="prefetch" href="/trainingdays/assets/js/30.6728cb2f.js"><link rel="prefetch" href="/trainingdays/assets/js/31.0447b951.js"><link rel="prefetch" href="/trainingdays/assets/js/32.7ba3de54.js"><link rel="prefetch" href="/trainingdays/assets/js/33.1886053c.js"><link rel="prefetch" href="/trainingdays/assets/js/34.71397a5c.js"><link rel="prefetch" href="/trainingdays/assets/js/35.3f4903ee.js"><link rel="prefetch" href="/trainingdays/assets/js/36.ca5c6cd3.js"><link rel="prefetch" href="/trainingdays/assets/js/37.150f3aea.js"><link rel="prefetch" href="/trainingdays/assets/js/38.267b0401.js"><link rel="prefetch" href="/trainingdays/assets/js/39.b63e5745.js"><link rel="prefetch" href="/trainingdays/assets/js/4.51ff6f02.js"><link rel="prefetch" href="/trainingdays/assets/js/40.ccce5e2d.js"><link rel="prefetch" href="/trainingdays/assets/js/41.8d1a41f2.js"><link rel="prefetch" href="/trainingdays/assets/js/42.b2565944.js"><link rel="prefetch" href="/trainingdays/assets/js/43.b9bb36ce.js"><link rel="prefetch" href="/trainingdays/assets/js/44.0cb215c3.js"><link rel="prefetch" href="/trainingdays/assets/js/45.ed0b28e2.js"><link rel="prefetch" href="/trainingdays/assets/js/46.d7dc415d.js"><link rel="prefetch" href="/trainingdays/assets/js/47.94e659f8.js"><link rel="prefetch" href="/trainingdays/assets/js/48.22da67bb.js"><link rel="prefetch" href="/trainingdays/assets/js/49.d0cc21bd.js"><link rel="prefetch" href="/trainingdays/assets/js/50.fc76ce90.js"><link rel="prefetch" href="/trainingdays/assets/js/51.49e6933d.js"><link rel="prefetch" href="/trainingdays/assets/js/52.b3007d12.js"><link rel="prefetch" href="/trainingdays/assets/js/53.ce74ac77.js"><link rel="prefetch" href="/trainingdays/assets/js/54.0ae1433b.js"><link rel="prefetch" href="/trainingdays/assets/js/55.84f6f655.js"><link rel="prefetch" href="/trainingdays/assets/js/56.8abf9a8b.js"><link rel="prefetch" href="/trainingdays/assets/js/57.5f879cc0.js"><link rel="prefetch" href="/trainingdays/assets/js/58.143be8bb.js"><link rel="prefetch" href="/trainingdays/assets/js/59.48d8acfe.js"><link rel="prefetch" href="/trainingdays/assets/js/6.49058ca4.js"><link rel="prefetch" href="/trainingdays/assets/js/60.a173b602.js"><link rel="prefetch" href="/trainingdays/assets/js/61.04f45b6d.js"><link rel="prefetch" href="/trainingdays/assets/js/62.c3ecf647.js"><link rel="prefetch" href="/trainingdays/assets/js/63.ad717965.js"><link rel="prefetch" href="/trainingdays/assets/js/64.3e451a8e.js"><link rel="prefetch" href="/trainingdays/assets/js/65.a310d4e8.js"><link rel="prefetch" href="/trainingdays/assets/js/66.91ad5d91.js"><link rel="prefetch" href="/trainingdays/assets/js/67.bdfc270a.js"><link rel="prefetch" href="/trainingdays/assets/js/68.7805630f.js"><link rel="prefetch" href="/trainingdays/assets/js/69.9a6edb47.js"><link rel="prefetch" href="/trainingdays/assets/js/7.3ee5fb68.js"><link rel="prefetch" href="/trainingdays/assets/js/70.2e5214af.js"><link rel="prefetch" href="/trainingdays/assets/js/71.0ed1ea53.js"><link rel="prefetch" href="/trainingdays/assets/js/72.05b27471.js"><link rel="prefetch" href="/trainingdays/assets/js/73.5cd028ca.js"><link rel="prefetch" href="/trainingdays/assets/js/74.cd61fe8d.js"><link rel="prefetch" href="/trainingdays/assets/js/75.8c8f40ca.js"><link rel="prefetch" href="/trainingdays/assets/js/76.50f7afaf.js"><link rel="prefetch" href="/trainingdays/assets/js/77.a0e160e0.js"><link rel="prefetch" href="/trainingdays/assets/js/78.c8465bf5.js"><link rel="prefetch" href="/trainingdays/assets/js/79.458fd2c0.js"><link rel="prefetch" href="/trainingdays/assets/js/8.3f86f0a0.js"><link rel="prefetch" href="/trainingdays/assets/js/80.454f4426.js"><link rel="prefetch" href="/trainingdays/assets/js/81.ed2d010d.js"><link rel="prefetch" href="/trainingdays/assets/js/82.cd4bb1c0.js"><link rel="prefetch" href="/trainingdays/assets/js/83.e3b63896.js"><link rel="prefetch" href="/trainingdays/assets/js/84.af75ea47.js"><link rel="prefetch" href="/trainingdays/assets/js/85.728f265c.js"><link rel="prefetch" href="/trainingdays/assets/js/86.e93b6d39.js"><link rel="prefetch" href="/trainingdays/assets/js/87.d5748615.js"><link rel="prefetch" href="/trainingdays/assets/js/9.b9da79d5.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.8d7a09fd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" aria-current="page" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 DevOps and Monitoring</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="💎-breakout-1-add-data-storage-services-to-our-sample-application-💎"><a href="#💎-breakout-1-add-data-storage-services-to-our-sample-application-💎" class="header-anchor">#</a> 💎 Breakout 1: Add data storage services to our sample application 💎</h1> <p>⏲️ <em>Est. time to complete: 90 min.</em> ⏲️</p> <h2 id="here-is-what-you-will-learn-🎯"><a href="#here-is-what-you-will-learn-🎯" class="header-anchor">#</a> Here is what you will learn 🎯</h2> <p>Now that we have made experience with Azure SQL DB, Azure CosmosDB and Azure (Cognitive) Search, it is time to add these services to our sample application.</p> <p>In this challenge you will:</p> <ul><li>use Azure SQL DB and CosmosDB to store objects from the application</li> <li>add an Azure Cognitive Search Instance</li> <li>make use of Azure Service Bus for messaging between the application services</li> <li>add additional application services</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 If you could not finish the breakout challenges of &quot;Day 2&quot;, there is a <a href="/trainingdays/day3/challenges/00-challenge-baseline.html">baseline deployment script</a> that will automatically deploy all necessary Azure services for you and put you in the position to start right away with this challenge.</p></div> <h2 id="table-of-contents"><a href="#table-of-contents" class="header-anchor">#</a> Table Of Contents</h2> <ol><li><a href="#introduction">Introduction</a></li> <li><a href="#setup-data-storage-services">Setup Data Storage Services</a></li> <li><a href="#setup-messaging-services">Setup Messaging Services</a></li> <li><a href="#quality-check">Quality Check</a></li> <li><a href="#re-deploy-contactsresources-service-and-image-resizer-function">Re-deploy Contacts/Resources Service and Image Resizer Function</a></li> <li><a href="#deploy-the-contacts-search-service">Deploy the Contacts Search Service</a></li> <li><a href="#deploy-the-visit-reports-service">Deploy the Visit Reports Service</a></li> <li><a href="#deploy-the-frontend">Deploy the Frontend</a></li> <li><a href="#wrap-up">Wrap-Up</a></li></ol> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>At the end of the day, the architecture will look like this:</p> <p><img src="/trainingdays/assets/img/architecture_day3breakout.9f69a960.png" alt="Architecture Day 3 - Breakout 1" title="Architecture Day 3 - Breakout 1"></p> <p>As you can see, we will introduce a new microservice (with its own data store - Cosmos DB) called &quot;Visit Reports&quot;, that allows us to add visit reports to existing contacts. We will have a <em>1-to-many</em> relation between <em>Contacts</em> and <em>Visit Reports</em>. And, to have the Visit Reports service being able to work on its own, it will also store some data coming from the <em>Contacts</em> service. So there will be some kind of duplication of data, which - in a microservice approach - is not an unusual thing.</p> <p>The services interact via the Azure Service Bus (Producer/Consumer pattern) and exchange data, when events occurs in e.g. the <em>Contacts</em> service.</p> <p>The advantage is, that the services aren't tied together via REST calls and can work and be scaled independently. If we would introduce another service in the future that needs information from a contact, we would simply introduce another consumer for the <em>Contacts</em> topic.</p> <p>In addition, we will also be migrating the Storage Queue services (for image resizing) to Azure Service Bus Queues so that we only have one messaging component in our architecture.</p> <p>The frontend will also change, as we introduce a new service:</p> <p><img src="/trainingdays/assets/img/scm_day3.53cc91e4.png" alt="Application Day 3 #1" title="Application Day 3 #1"> <img src="/trainingdays/assets/img/scm_day3_vr.4daba24d.png" alt="Application Day 3 #2" title="Application Day 3 #2"> <img src="/trainingdays/assets/img/scm_day3_search.a39be81b.png" alt="Application Day 3 #3" title="Application Day 3 #3"></p> <h2 id="setup-data-storage-services"><a href="#setup-data-storage-services" class="header-anchor">#</a> Setup Data Storage Services</h2> <p>First of all, we now add an Azure SQL DB, Cosmos DB and an Azure Search service for the application.</p> <h3 id="sql-db"><a href="#sql-db" class="header-anchor">#</a> SQL DB</h3> <p>Create a new Azure SQL DB either via the Azure Portal or Azure CLI.</p> <p>Database Properties:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Resource group</em></td> <td>use your existing resource group: <strong>scm-breakout-rg</strong></td></tr> <tr><td><em>Compute + storage</em></td> <td>Basic tier</td></tr> <tr><td><em>Location</em></td> <td>West Europe</td></tr> <tr><td><em>Server</em></td> <td>Create a new server in West Europe</td></tr> <tr><td><em>Networking Tab</em></td> <td><em>Connectivity =&gt; Public</em> <br> <strong>Allow Azure services and resources to access this server</strong> is set to <strong>YES</strong></td></tr></tbody></table> <p>Leave all other settings as proposed by Azure.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 You can proceed with the next step while the Azure SQL DB is being created.</p></div> <p><img src="/trainingdays/assets/img/bo_data_sql.894f3439.png" alt="Azure SQL Database" title="Azure SQL Database"></p> <h3 id="cosmos-db-sql-api"><a href="#cosmos-db-sql-api" class="header-anchor">#</a> Cosmos DB / SQL API</h3> <p>Create a new Azure Cosmos Account either via the Azure Portal or Azure CLI.</p> <p>Account Properties:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Resource group</em></td> <td>use your existing resource group: <strong>scm-breakout-rg</strong></td></tr> <tr><td><em>API</em></td> <td>Core SQL</td></tr> <tr><td><em>Location</em></td> <td>West Europe</td></tr> <tr><td><em>Capacity mode</em></td> <td><strong>OPTIONAL</strong> - if you want to, you can choose Serverless</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 The <code>Serverless</code> option is a perfect fit for development environments and small applications. You can find out more about the deployment option here: <a href="https://docs.microsoft.com/azure/cosmos-db/throughput-serverless" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/azure/cosmos-db/throughput-serverless<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>Leave all other settings as proposed by Azure.</p> <p><img src="/trainingdays/assets/img/bo_data_cosmos.97f66e4c.png" alt="Azure CosmosDB Account" title="Azure CosmosDB Account"></p> <p>When the deployment has finished (creating the account takes some time - you can grab a coffee), create a new <em>Database</em> and <em>Container</em> under &quot;Data Explorer&quot; in the portal for the Visit Reports microservice.</p> <p>Database Properties:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Database ID</em></td> <td><em>scmvisitreports</em></td></tr> <tr><td><em>Provision Database Throughput</em></td> <td>true (not neccessary, if you chose to enable <em>Serverless</em> mode)</td></tr> <tr><td><em>RU/s</em></td> <td>Manual / 400 (not neccessary, if you chose to enable <em>Serverless</em> mode)</td></tr></tbody></table> <p>Container Properties:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Database ID</em></td> <td>scmvisitreports</td></tr> <tr><td><em>Container ID</em></td> <td>visitreports</td></tr> <tr><td><em>Partition</em></td> <td>/type</td></tr></tbody></table> <p><img src="/trainingdays/assets/img/bo_data_cosmos2.2c94b09a.png" alt="Azure CosmosDB Data Explorer" title="Azure CosmosDB Data Explorer"></p> <h3 id="azure-cognitive-search"><a href="#azure-cognitive-search" class="header-anchor">#</a> Azure Cognitive Search</h3> <p>Create a new Azure Cognitive Search Account either via the Azure Portal or Azure CLI.</p> <p>Account Properties:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td>_Resource Group</td> <td>use your existing resource group: <strong>scm-breakout-rg</strong></td></tr> <tr><td><em>Location</em></td> <td>West Europe</td></tr> <tr><td><em>Pricing Tier</em></td> <td>Free*(for development purposes - if that is not possible, choose_Basic*)</td></tr></tbody></table> <p>Leave all other settings as proposed by Azure.</p> <p><img src="/trainingdays/assets/img/bo_data_search.a00cda33.png" alt="Azure Cognitive Search" title="Azure Cognitive Search"></p> <h2 id="setup-messaging-services"><a href="#setup-messaging-services" class="header-anchor">#</a> Setup Messaging Services</h2> <p>Create a new Azure Service Bus either via the Azure Portal or Azure CLI.</p> <p>Service Bus Properties:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Resource Group</em></td> <td>use your existing resource group: <strong>scm-breakout-rg</strong></td></tr> <tr><td><em>Pricing Tier</em></td> <td>Standard</td></tr> <tr><td><em>Location</em></td> <td>West Europe</td></tr></tbody></table> <p>Leave all other settings as proposed by Azure.</p> <h3 id="service-bus-queue"><a href="#service-bus-queue" class="header-anchor">#</a> Service Bus Queue</h3> <p>When the deployment of the new Service Bus has finished, we need to add a Service Bus <strong>Queue</strong>. The queue will replace the Storage Account Queue we used to notify an Azure Function that creates thumbnails of contact images.</p> <p>Service Bus Queue Properties:</p> <ul><li>Name: <em>sbq-scm-thumbnails</em></li></ul> <p>When successfully added, go to <strong>Shared Access Policies</strong> of the <strong>Service Bus Queue (!)</strong> and add two policies:</p> <ul><li>Name: <em>listen</em> (enable checkbox <strong>Listen</strong>)
<ul><li>will be used by clients that only need to listen to the Service Bus Queue</li></ul></li> <li>Name: <em>send</em> (enable checkbox <strong>Send</strong>)
<ul><li>will be used by clients that also need to be able to send messages to the Service Bus Queue</li></ul></li></ul> <p>Our producers/consumers will use these Access Policies to be able to send and listen to/on that specific queue.</p> <h3 id="service-bus-topic-for-contacts"><a href="#service-bus-topic-for-contacts" class="header-anchor">#</a> Service Bus Topic for Contacts</h3> <p>We also nee a topic for handling <em>Contacts</em> changes (create, update etc.) with corresponding subscriptions. Go back to the Service Bus Namespace in the Portal and add a new topic.</p> <p>Contacts Topic Properties:</p> <ul><li>Name: <em>sbt-contacts</em></li></ul> <p>Leave all other settings as suggested and click <strong>Create</strong>. When finished, open the topic and add two subscriptions.</p> <p>Subscription for Search Service / indexing of contacts:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Name</em></td> <td>contactsearch</td></tr> <tr><td><em>Max delivery count</em></td> <td>10</td></tr> <tr><td><em>Enable Sessions</em></td> <td>true (in this sample, we will be using Service Bus sessions!)</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 <code>Sessions</code> enable the first-in, first out (FIFO) pattern within Azure Service Bus. If you want to know more about it, have a look at the official docs: <a href="https://docs.microsoft.com/azure/service-bus-messaging/message-sessions" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/azure/service-bus-messaging/message-sessions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>Subscription for Visit Reports Service</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Name</em></td> <td>visitreports</td></tr> <tr><td><em>Max delivery count</em></td> <td>10</td></tr> <tr><td><em>Enable Sessions</em></td> <td>false</td></tr></tbody></table> <p>When you have successfully added the two subscriptions, go back to <strong>Shared Access Policies</strong> of the Service Bus Topic <strong>sbt-contacts</strong> and add two policies:</p> <ul><li>Name: <em>listen</em> (enable checkbox <strong>Listen</strong>)
<ul><li>will be used by clients that only need to listen to the Service Bus Topic</li></ul></li> <li>Name: <em>send</em> (enable checkbox <strong>Send</strong>)
<ul><li>will be used by clients that also need to be able to send messages to the Service Bus Topic</li></ul></li></ul> <h3 id="service-bus-topic-for-visit-reports"><a href="#service-bus-topic-for-visit-reports" class="header-anchor">#</a> Service Bus Topic for Visit Reports</h3> <p>We also need a topic for handling <em>Visit Report</em> changes (create, update etc.). Go back to the Service Bus Namespace in the Portal and add a new topic.</p> <p>Visit Reports Topic Properties:</p> <ul><li>Name: <em>sbt-visitreports</em></li></ul> <p>Leave all other settings as suggested and click <strong>Create</strong>.</p> <p>When successfully added, go back to <strong>Shared Access Policies</strong> of the Service Bus Topic <strong>sbt-visitreports</strong> and add two policies:</p> <ul><li>Name: <em>listen</em> (enable checkbox <strong>Listen</strong>)
<ul><li>will be used by clients that only need to listen to the Service Bus Topic</li></ul></li> <li>Name: <em>send</em> (enable checkbox <strong>Send</strong>)
<ul><li>will be used by clients that also need to be able to send messages to the Service Bus Topic</li></ul></li></ul> <p>We don't add a subscription for the <em>visit report</em> topic at the moment. The topic will be used later when we integrate further services like Azure Congitive Services.</p> <h2 id="quality-check"><a href="#quality-check" class="header-anchor">#</a> Quality Check</h2> <p>You should have created the following Azure services by now:</p> <ul><li><a href="#sql-db">Azure SQL DB</a></li> <li><a href="#cosmos-db--sql-api">Azure Cosmos DB (database + container)</a></li> <li><a href="#azure-cognitive-search">Azure Cognitive Search</a></li> <li><a href="#setup-messaging-services">Azure Service Bus</a> <ul><li><a href="#service-bus-queue">Queue for thumbnail generation</a> <ul><li>Shared Access Policies for <em>listen</em> and <em>send</em></li></ul></li> <li><a href="#service-bus-topic-for-contacts">Topic for Contacts</a> <ul><li>Shared Access Policies for <em>listen</em> and <em>send</em></li> <li>subscription for visit reports</li> <li>subscription for search service</li></ul></li> <li><a href="#service-bus-topic-for-visit-reports">Topic for Visit Reports</a> <ul><li>Shared Access Policies for <em>listen</em> and <em>send</em></li></ul></li></ul></li></ul> <p>If you missed to create one of these services, please click on the corresponding link and go back the specific section.</p> <h2 id="re-deploy-contacts-resources-service-and-image-resizer-function"><a href="#re-deploy-contacts-resources-service-and-image-resizer-function" class="header-anchor">#</a> Re-deploy Contacts/Resources Service and Image Resizer Function</h2> <p>Because we refactored the <strong>Contacts</strong> and <strong>Resources APIs</strong> to use <strong>Azure Service Bus</strong> for inter-service communication, we need to deploy new versions of these application services and change some of the App Configuration/Settings we added on <strong>Day 2</strong>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 We will be re-using the Azure service instances from <strong>Day 2</strong>!</p></div> <h3 id="alter-app-configuration-settings"><a href="#alter-app-configuration-settings" class="header-anchor">#</a> Alter App Configuration/Settings</h3> <p>We will <strong>reuse the Web Apps for Contacts and Resources</strong> as well as the Azure Function for image manipulation we created yesterday. So, first we will adjust the App Configuration for each of the services.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 Use a second browser window/tab to be able to switch back and forth while adding the configuration settings.</p></div> <p>Azure Web App for <strong>Contacts Service</strong>:</p> <p>Application Configuration/Settings:</p> <table><thead><tr><th>Parameter</th> <th>Value / Hint</th></tr></thead> <tbody><tr><td>EventServiceOptions__ServiceBusConnectionString</td> <td>use the Connection String from the Shared Access Policy (<strong>Topic sbt-contacts</strong>) for sending messages - <strong>send</strong></td></tr></tbody></table> <p>Connection Strings:</p> <table><thead><tr><th>Parameter</th> <th>Value / Hint</th> <th>Type</th></tr></thead> <tbody><tr><td>DefaultConnectionString</td> <td>go to the Azure SQL DB you created and use the ADO.NET connection string (under &quot;<strong>Settings</strong>&quot; / &quot;<strong>Connection strings</strong>&quot;). Don't forget to add your password to the connection string!</td> <td><em>SQLAzure</em></td></tr></tbody></table> <p><img src="/trainingdays/assets/img/portal_bo_adjust_contactsapi.1aaeffeb.png" alt="Contacts API Configuration Settings" title="Contacts API Configuration Settings"></p> <p>Azure Web App for <strong>Resources Service</strong>:</p> <p>Application Settings:</p> <table><thead><tr><th>Parameter</th> <th>Value / Hint</th></tr></thead> <tbody><tr><td>ImageStoreOptions__ThumbnailContainer</td> <td><em>thumbnails</em></td></tr> <tr><td>ImageStoreOptions__ImageContainer</td> <td><em>rawimages</em></td></tr> <tr><td>ImageStoreOptions__StorageAccountConnectionString</td> <td>use the <strong>Connection String</strong> from your Storage Account created in the Break Out session yesterday (should be the same)</td></tr> <tr><td>ServiceBusQueueOptions__ImageContainer</td> <td><em>rawimages</em></td></tr> <tr><td>ServiceBusQueueOptions__ThumbnailContainer</td> <td><em>thumbnails</em></td></tr> <tr><td>ServiceBusQueueOptions__ThumbnailQueueConnectionString</td> <td>use the Connection String from the Shared Access Policy (<strong>Queue sbq-scm-thumbnails</strong>) for sending messages - <strong>send</strong></td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 You can delete all <strong>StorageQueueOptions__</strong> app settings!</p></div> <p><img src="/trainingdays/assets/img/portal_bo_adjust_resapi.5d428cf3.png" alt="Resources API Configuration Settings" title="Resources API Configuration Settings"></p> <p>Azure Function for <strong>Image Manipulation / Resizer Service</strong>:</p> <p>Configuration / Application Settings:</p> <table><thead><tr><th>Parameter</th> <th>Value / Hint</th></tr></thead> <tbody><tr><td>ServiceBusConnectionString</td> <td>use the Connection String from the Shared Access Policy (<strong>Queue sbq-scm-thumbnails</strong>) for listening for messages - <strong>listen</strong> <br><br><span style="color:red;"><strong>Important</strong></span>: Please remove the <em>EntityPath</em> variable (incl. the value) at the end of the connection string!</td></tr> <tr><td>ImageProcessorOptions__ImageWidth</td> <td><em>100</em></td></tr> <tr><td>ImageProcessorOptions__StorageAccountConnectionString</td> <td>use the <strong>Connection String</strong> from your Storage Account created in the Break Out session yesterday (should be the same)</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 You can delete the <strong>QueueName</strong> app settings!</p></div> <p><img src="/trainingdays/assets/img/portal_bo_adjust_imgmanipulation.ed039b8f.png" alt="Adjust Configuration Settings" title="Adjust Configuration Settings"></p> <h3 id="redeploy-the-services-for-contacts-resources-and-image-manipulation"><a href="#redeploy-the-services-for-contacts-resources-and-image-manipulation" class="header-anchor">#</a> Redeploy the services for Contacts, Resources and Image Manipulation</h3> <p>First of all: as seen in the Break Out session yesterday, everything is pre-created for you...this time, you need to open VS Code with the prepared workspace for <strong>Day 3 / Breakout 1</strong> (<code>day3/day3-breakout1.code-workspace</code>).</p> <p>The folder structure looks as follows:</p> <p><img src="/trainingdays/assets/img/bo1_code.a0ab3563.png" alt="Visual Studio Code Workspace for Day 3 / Breakout 1" title="Visual Studio Code Workspace for Day 3 / Breakout 1"></p> <p>You will see additional projects added to the workspace compared to <code>Breakout 2</code> of <strong>Day 2</strong>:</p> <ul><li><strong>Search API</strong> - contains the backend logic for searching for <em>contacts</em> objects via Azure Cognitive Search</li> <li><strong>Search Indexer Function</strong> - contains the Azure Function to index contacts when a contact object has been created/updated</li> <li><strong>Visit Reports API</strong> - contains the backend logic for managing <em>visitreport</em> objects</li></ul> <p>For now, we don't need to deal with the added projects. We simply redeploy the existing ones. You have deployed web apps and functions several times yesterday, so you should be familiar with the process.</p> <p>So please re-deploy the Web Apps/Functions for:</p> <ul><li>Contacts API</li> <li>Resources API</li> <li>Image Resizer Function</li></ul> <p><img src="/trainingdays/assets/img/bo1_redeploy.ef4b9a4b.png" alt="Projects That Need To Be Re-Deployed" title="Projects That Need To Be Re-Deployed"></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>⚠️ Please make sure you use the versions from the &quot;Day3 - Breakout 1 Workspace&quot;! Double-check that you use the correct VS Code workspace. The services have also been adjusted on the code level.</p></div> <h2 id="deploy-the-contacts-search-service"><a href="#deploy-the-contacts-search-service" class="header-anchor">#</a> Deploy the Contacts Search Service</h2> <p>To be able to run the Contacts Search service (where we leverage the core functionality of Azure Search), we first need an Azure Web App to host it. So, please go to the Portal (or use the Azure CLI) and create an Azure Web App (with a new Azure AppService Plan on Windows, Runtime <strong>.NET 6</strong>) - use SKU / Size <strong>S1</strong>.</p> <p>When finished, apply these settings to the Web App Configuration settings:</p> <table><thead><tr><th>Parameter</th> <th>Value / Hint</th></tr></thead> <tbody><tr><td>ContactSearchOptions__AdminApiKey</td> <td>use the Primary Admin Key from Azure Search (under <strong>Settings / Keys</strong>)</td></tr> <tr><td>ContactSearchOptions__IndexName</td> <td><em>scmcontacts</em></td></tr> <tr><td>ContactSearchOptions__ServiceName</td> <td>the name of your previously created Azure Search (just the subdomain! So from <a href="https://adcd3search-dev.search.windows.net" target="_blank" rel="noopener noreferrer">https://adcd3search-dev.search.windows.net<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, only <strong>adcd3search-dev</strong>)</td></tr></tbody></table> <p><img src="/trainingdays/assets/img/portal_bo_add_search.be3d130c.png" alt="Search API Configuration Settings" title="Search API Configuration Settings"></p> <p><strong>Time to deploy the Contacts Search</strong> (folder <em>Search API</em> in VS Code) service to the newly created Azure AppService. Please deploy that service like you did with the Contacts API or Resources API (via right-click-deployment from within VS Code).</p> <h3 id="create-and-deploy-the-contacts-search-indexer-function"><a href="#create-and-deploy-the-contacts-search-indexer-function" class="header-anchor">#</a> Create and deploy the Contacts Search Indexer Function</h3> <p>Now we have deployed an Azure Search Service and an API that is able to query the search index. But how will contacts be pushed to the Azure Search index? Therefore, we will be using another Azure Function that listens to created and changed contacts via an Azure Service Bus Topic (<strong>sbt-contacts</strong>, you already created it - as well as the corresponding subscription <strong>contactsearch</strong>)!</p> <p>Create the Azure function in the <strong>scm-breakout-rg</strong> resource group with the follwing parameters:</p> <table><thead><tr><th>Parameter</th> <th>Value / Hint</th></tr></thead> <tbody><tr><td>Publish</td> <td><em>Code</em></td></tr> <tr><td>Runtime</td> <td><em>.NET</em></td></tr> <tr><td>Version</td> <td><em>6</em></td></tr> <tr><td>Region</td> <td><em>West Europe</em></td></tr> <tr><td>OS</td> <td><em>Windows</em></td></tr> <tr><td>Storage Account</td> <td>Use the storage account you created in the breakout resource group</td></tr> <tr><td>Plan Type</td> <td><em>Consumption</em></td></tr></tbody></table> <p>When finished, apply these settings to the App Configuration settings:</p> <table><thead><tr><th>Parameter</th> <th>Value / Hint</th></tr></thead> <tbody><tr><td>ContactIndexerOptions__AdminApiKey</td> <td>use the Primary Admin Key from Azure Search (under <strong>Settings / Keys</strong>)</td></tr> <tr><td>ContactIndexerOptions__IndexName</td> <td><em>scmcontacts</em></td></tr> <tr><td>ContactIndexerOptions__ServiceName</td> <td>the name of your previously created Azure Search (just the subdomain! So from <a href="https://adcd3search-dev.search.windows.net" target="_blank" rel="noopener noreferrer">https://adcd3search-dev.search.windows.net<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, only <strong>adcd3search-dev</strong>)</td></tr> <tr><td>ServiceBusConnectionString</td> <td>use the Service Bus Connection String from the Shared Access Policy (<strong>Topics</strong> / <strong>sbt-contacts</strong>) for listening for messages - <strong>listen</strong>. <br><br><span style="color:red;"><strong>Important</strong></span>: Please remove the <strong>EntityPath</strong> variable (incl. the value) at the end of the connection string!</td></tr></tbody></table> <p><img src="/trainingdays/assets/img/portal_bo_add_searchindexer.55902652.png" alt="Search Indexer Function Configuration Settings" title="Search Indexer Function Configuration Settings"></p> <p><strong>Last but not least</strong>, deploy the Contacts Search indexer function (folder <em>Search Indexer Function</em>) service from VS Code to the previously created Function App.</p> <h2 id="⏸️-let-s-press-pause-for-a-moment-what-have-we-done-so-far"><a href="#⏸️-let-s-press-pause-for-a-moment-what-have-we-done-so-far" class="header-anchor">#</a> ⏸️ Let's press &quot;Pause&quot; for a moment - What have we done so far?</h2> <p>The was a lot of manual typing so far, so let's hold on for a moment. We have just migrated our initial services (Contacts and Resources, Image Resizer) to Azure Service Bus Queues and Topics. We redeployed new versions of these services to make use of Azure Service Bus. We also added Storage Services to our application. The Contacts Service now uses Azure SQL DB.</p> <p>In addition, we added an Azure Search service (incl. indexer function) plus an API that is able to talk to Azure Search and query for contacts. The contacts will be added / updated in the search index &quot;on-the-fly&quot; whenever a contact is changed/created - notification is done via Service Bus Topics.</p> <p>Regarding our architecture, we are at this stage:</p> <p><img src="/trainingdays/assets/img/architecture_day3breakout1.3180df52.png" alt="Architecture Breakout 1" title="Architecture Breakout 1"></p> <p>Now, let's add the Visit Reports API.</p> <h2 id="deploy-the-visit-reports-service"><a href="#deploy-the-visit-reports-service" class="header-anchor">#</a> Deploy the Visit Reports Service</h2> <p>To deploy the Visit Reports API, we - as usual - need another Web App. As this service runs on NodeJS and we want to leverage <strong>Azure Web Apps on Linux</strong> this time, let's create one that is backed by a Linux OS.</p> <p><strong>Azure WebApp Properties</strong></p> <p>Create the Linux Web App with the following parameters.</p> <table><thead><tr><th>Parameter</th> <th>Value / Hint</th></tr></thead> <tbody><tr><td>Resource Group</td> <td><strong>scm-breakout-rg</strong></td></tr> <tr><td>Publish</td> <td><em>Code</em></td></tr> <tr><td>Runtime Stack</td> <td><em>Node 14 LTS</em></td></tr> <tr><td>App Service Plan</td> <td>Create a new one: OS - <em>Linux</em>, SKU - <em>S1</em></td></tr></tbody></table> <p><img src="/trainingdays/assets/img/day3_bo_tux_vr.f3222ff3.png" alt="Visit Reports API AppService" title="Visit Reports API AppService"></p> <p>When the Web App has been created, go to the Configuration section and add the following settings (App settings + Connection strings!).</p> <p><strong>Azure Web App / Configuration / Application Settings</strong></p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td>APPINSIGHTS_KEY</td> <td>&lt;empty&gt;</td></tr> <tr><td>COSMOSDB</td> <td>the endpoint to the Cosmos DB, e.g. <a href="https://adcd3cosmos-dev.documents.azure.com:443/" target="_blank" rel="noopener noreferrer">https://adcd3cosmos-dev.documents.azure.com:443/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr></tbody></table> <p><strong>Azure Web App / Configuration / Connection Strings</strong></p> <table><thead><tr><th>Parameter</th> <th>Value</th> <th>Type</th></tr></thead> <tbody><tr><td>COSMOSKEY</td> <td>Primary Key of your Cosmos DB</td> <td><em>Custom</em></td></tr> <tr><td>SBCONTACTSTOPIC_CONNSTR</td> <td>Primary Connection String of the Service Bus <strong>Contacts</strong> Topic (<strong>sbt-contacts</strong> / <em>listen</em>)</td> <td><em>Custom</em></td></tr> <tr><td>SBVRTOPIC_CONNSTR</td> <td>Primary Connection String of the Service Bus <strong>Visit Reports</strong> Topic (<strong>sbt-visitreports</strong> / <em>send</em>)</td> <td><em>Custom</em></td></tr></tbody></table> <p><img src="/trainingdays/assets/img/portal_bo_add_vr.36fd22ca.png" alt="Visit Reports API Configuration Settings" title="Visit Reports API Configuration Settings"></p> <p>Now, from an infrastructure point of view, we are ready to deploy the NodeJS app. Right-click on the folder <code>Visit Reports API</code>, select the correct Azure AppService and confirm the deployment to it.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 While deploying to the AppService, Azure will run <code>npm install</code> for you, so you don't need to do this upfront. This will keep the amount of data sent to Azure quite small and reduces the deployment duration significantly! The technology working behind the scenes is called <code>Oryx</code>. If you want to know more about it and how to configure builds during deployment, this is the way to the GitHub repository: <a href="https://github.com/microsoft/Oryx" target="_blank" rel="noopener noreferrer">https://github.com/microsoft/Oryx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Oryx configuration: <a href="https://github.com/microsoft/Oryx/blob/master/doc/configuration.md#oryx-configuration" target="_blank" rel="noopener noreferrer">https://github.com/microsoft/Oryx/blob/master/doc/configuration.md#oryx-configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>In the output window, watch how the NodeJS app is copied to the Web App and is being started by Azure.</p> <p>You can check, if it's running correctly by opening a browser window and point it to the following URL:</p> <p><a href="https://YOUR_WEB_APP_NAME.azurewebsites.net/docs" target="_blank" rel="noopener noreferrer">https://YOUR_WEB_APP_NAME.azurewebsites.net/docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>⚠️ You will see the Swagger UI of the visit reports service - in the <strong>Explore</strong> textbox, replace <strong>json</strong> with <strong>yaml</strong> to view all operations.</p></div> <p><img src="/trainingdays/assets/img/day3_bo_tux_vr_swagger.b6664ebb.png" alt="Visit Reports API Swagger Definition" title="Visit Reports API Swagger Definition"></p> <h2 id="deploy-the-frontend"><a href="#deploy-the-frontend" class="header-anchor">#</a> Deploy the Frontend</h2> <p>Now that we have introduced a few new services, we also need to redeploy the VueJS frontend. Of course, we also added a few changes in the UI itself (please see the intro section). So we definetly want that new version running now in Azure.</p> <p>Open the <code>settings.js</code> file in folder <em>Frontend</em> --&gt; <em>public/settings</em> and adjust the settings to fit the URLs of your Web Apps. You will need:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td>endpoint</td> <td>URL of the contacts API endpoint, e.g. <a href="https://adcday3scmapi-dev.azurewebsites.net/" target="_blank" rel="noopener noreferrer">https://adcday3scmapi-dev.azurewebsites.net/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>resourcesEndpoint</td> <td>URL of the resources API endpoint, e.g. <a href="https://adcday3scmresourcesapi-dev.azurewebsites.net/" target="_blank" rel="noopener noreferrer">https://adcday3scmresourcesapi-dev.azurewebsites.net/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>searchEndpoint</td> <td>URL of the search API endpoint, e.g. <a href="https://adcday3scmrsearchapi-dev.azurewebsites.net/" target="_blank" rel="noopener noreferrer">https://adcday3scmrsearchapi-dev.azurewebsites.net/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>reportsEndpoint</td> <td>URL of the visit reports API endpoint, e.g. <a href="https://adcday3scmvr-dev.azurewebsites.net" target="_blank" rel="noopener noreferrer">https://adcday3scmvr-dev.azurewebsites.net<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>enableStats</td> <td>false (we will be adding statistics when we introduced Cognitive Services in the next challenge)</td></tr> <tr><td>aiKey</td> <td>&quot;&quot; (just leave it empty)</td></tr></tbody></table> <p><strong>Sample:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code>var uisettings = <span class="token punctuation">{</span>
    <span class="token property">&quot;endpoint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://adcday3scmapi-dev.azurewebsites.net/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resourcesEndpoint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://adcday3scmresourcesapi-dev.azurewebsites.net/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;searchEndpoint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://adcday3scmrsearchapi-dev.azurewebsites.net/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;reportsEndpoint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://adcday3scmvr-dev.azurewebsites.net&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;enableStats&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;aiKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>After you have adjusted the settings, open an <strong>integrated terminal</strong> in VS Code for folder <em>Frontend</em> and run...</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build
</code></pre></div><p>The VueJS app is built into folder <em>dist</em> of the <code>Frontend</code> directory. When the build has finished, right-click on that <code>dist</code> folder and choose &quot;Deploy to Static Website via Azure Storage&quot; and select the correct storage account.</p> <p>When everything is set up correctly and the services work as expected, you should be able to open the SPA and test the Contacts and Visit Reports services, as well as the Search service.</p> <p>Add and edit a few new contacts (search for them via the top navigation bar) and create some visit reports for them.</p> <p><img src="/trainingdays/assets/img/scm_day3.53cc91e4.png" alt="SCM Contacts List" title="SCM Contacts List"> <img src="/trainingdays/assets/img/scm_day3_vr.4daba24d.png" alt="Visit Report Detail" title="Visit Report Detail"></p> <h1 id="wrap-up"><a href="#wrap-up" class="header-anchor">#</a> Wrap-Up</h1> <p>So, we know, this was a lot of manual work to do, to add a simple microservice-oriented application to Azure. There are a lot of moving parts in that kind of applications and you will want to avoid deploying such applications manually. That's why we will be introducing Azure DevOps on Day 4, so that you can build and deploy the infrastructure as well as the services automatically.
Anyway, we wanted to show you how it's done &quot;the hard way&quot; to bring you relief the day after.</p> <p>We now have one more challenge to complete (Cognitive Services), until the application is finished from a services perspective.</p> <p>In this Breakout Challenge, you made use of:</p> <ul><li><a href="https://docs.microsoft.com/azure/azure-sql/" target="_blank" rel="noopener noreferrer">Azure SQL DB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/azure/cosmos-db/" target="_blank" rel="noopener noreferrer">Azure CosmosDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/azure/service-bus-messaging/" target="_blank" rel="noopener noreferrer">Azure Service Bus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/azure/search/" target="_blank" rel="noopener noreferrer">Azure Cognitive Search<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/azure/app-service/" target="_blank" rel="noopener noreferrer">Azure AppServices on Linux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><a href="/trainingdays/day3/challenges/03-challenge-search.html">◀ Previous challenge</a> | <a href="/trainingdays/day3/" class="router-link-active">🔼 Day 3</a> | <a href="/trainingdays/day3/challenges/05-challenge-cognitive-services.html">Next challenge ▶</a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day3/challenges/04-challenge-bo-1.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.e8a6fdbf.js" defer></script><script src="/trainingdays/assets/js/3.9b3cf7d1.js" defer></script><script src="/trainingdays/assets/js/5.8a1a1dd9.js" defer></script>
  </body>
</html>
