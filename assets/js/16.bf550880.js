(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{339:function(t,e,a){t.exports=a.p+"assets/img/deploytoazure.e0e5d477.png"},340:function(t,e,a){t.exports=a.p+"assets/img/UploadCSEtoContainer.a339b5d5.png"},341:function(t,e,a){t.exports=a.p+"assets/img/AddCSE-HelloWorldToVM2.0e40b952.png"},342:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAxwAAAAxCAYAAABQ3a99AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAy7SURBVHhe7ZtNr2XFdYb5R/wL+AkwiKLMiCxPoogfEJxkyBxseRLCmIEdxUjMUGIsHBiC7BkSkhWYMr3W09yXfnt17bNv33O2+348j1Q6u6rWWrXWqo996vTtV65EREREREQOwguHiIiIiIgchhcOERERERE5DC8cIiIiIiJyGF44RERERETkMLxwiIiIiIjIYexeOL7//79YLBaLxWKxWCwWy3PlJvgvHCIiIiIichheOERERERE5DC8cIiIiIiIyGF44RARERERkcPwwiEiIiIiIofhhUNERERERA7DC4eIiIiIiByGFw4RERERETkMLxwiIiIiInIYXjhEREREROQwvHCIiIiIiMhheOEQEREREZHDuNiF44cffrh66623rl555ZWfygcffHDde/fB10v4jh55IB+35dNPP33GF8o777xz3fvyuUSMDwHm5PXXX7/67rvvrlueJfPIJyCHfOp3id6/L7L251o9lY+Hgmfdj1ziHLjrZ91tYP2Tl719QP7u4llwNMxvz/fRZwbj7a2pr7766uq111578nkJLm3vIcFcv/nmm7fOzbn68vK4yIWDiX/11VefeXHxEnrvvffO/lLKQXHbF+JNmQcSPn/00UfXtWNZbR5eQrd5kZOnvYNVLge5fuONN5brk7nLl9L78KVirh3WI+vy1BcB5OeXBWK9y/HeJK5TeNbdnlXuH9pZh197X6KJmX7yTnlsX57mOuf5MfxQIT/CPJ+z5s/Vfyz8+c9/uvr1r3559fHv/vu65Sl/+Oyzq1+9/96Tzwny6KF/ac6+cDD5HBZHfck4+iWcL4Yv60vSavM8tJfwQ4Vcc+FYzRVzyLxSXtbaehHmPlt9OWyQvc0afdnsxXUKz7rzWOX+IZ112RNffPHF7hrLWnqMX7TnOmfu3377bb9APhJY7+yP2873ufqPhbf/+Z+u/uHv/+5J+b8//vG69cf8pZ3S5w9yaUf/0px94bjJC2P1opkvDJ7zT6zY+/777598po1fFbPAsMNBnb4+tPNS5ZejyGA77dMW0N++rGj/Ml5i57CknXrnI2N+/PHHP40dOcAHfEl79LZy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"},343:function(t,e,a){t.exports=a.p+"assets/img/AddCSE-HelloWorldToVM4Result.a9275f45.png"},344:function(t,e,a){t.exports=a.p+"assets/img/AddCSE-HelloWorldToVM5DownloadFolder.0ef95226.png"},345:function(t,e,a){t.exports=a.p+"assets/img/AddCSE-HelloWorldToVM6LogsFolder.6dda7ef1.png"},346:function(t,e,a){t.exports=a.p+"assets/img/saUploadCSE2.b3e7ae7c.png"},347:function(t,e,a){t.exports=a.p+"assets/img/ModifyARM.059cd7f7.png"},348:function(t,e,a){t.exports=a.p+"assets/img/CSE-Deployment.887c14a6.png"},349:function(t,e,a){t.exports=a.p+"assets/img/CSEIIS-Success.4d031f79.png"},734:function(t,e,a){"use strict";a.r(e);var s=a(10),n=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"challenge-7-optional-vm-and-custom-script-extensions-post-deployment-automation-or-configure-setup-install-something-within-an-empty-vm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#challenge-7-optional-vm-and-custom-script-extensions-post-deployment-automation-or-configure-setup-install-something-within-an-empty-vm"}},[t._v("#")]),t._v(" Challenge 7 (optional): VM and Custom Script Extensions - Post deployment automation  or configure / setup / install something within an empty vm")]),t._v(" "),e("h2",{attrs:{id:"here-is-what-you-will-learn-🎯"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-will-learn-🎯"}},[t._v("#")]),t._v(" Here is what you will learn 🎯")]),t._v(" "),e("ul",[e("li",[t._v("How to automate the further configuration / setup of an '"),e("em",[t._v("empty")]),t._v("' VM after it has been deployed.")]),t._v(" "),e("li",[t._v("Use a Custom Script Extension for a Windows VM.")]),t._v(" "),e("li",[t._v("Upload automation code into a storage account for anonymous download (so that the CSE agent can download)")]),t._v(" "),e("li",[t._v("Modify an ARM Template to enable '"),e("em",[t._v("zero touch VM deployments")]),t._v("'")])]),t._v(" "),e("h2",{attrs:{id:"table-of-contents"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#table-of-contents"}},[t._v("#")]),t._v(" Table Of Contents")]),t._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"#do-you-need-a-vm"}},[t._v("Do you need a VM?")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#attach-a-simple-helloworld-custom-script-extension-cse-to-a-vm-using-the-portal"}},[t._v("Attach a simple HelloWorld Custom Script Extension (CSE) to a VM using the Portal")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#see-what-has-happened-inside-the-vm"}},[t._v("See what has happened inside the VM")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#attaching-a-cse-to-a-vm-in-an-arm-template-optional"}},[t._v("Attaching a CSE to a VM in an ARM Template (optional)")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#cleanup"}},[t._v("Cleanup")])])]),t._v(" "),e("h2",{attrs:{id:"do-you-need-a-vm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#do-you-need-a-vm"}},[t._v("#")]),t._v(" Do you need a VM?")]),t._v(" "),e("p",[t._v("For this lab you need an Azure virtual machine that runs Windows Server and some storage accessible to hold your automation code."),e("br"),t._v("\nJust "),e("strong",[t._v("click")]),t._v(" "),e("a",{attrs:{href:"https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fazuredevcollege%2Ftrainingdays%2Fmaster%2Fday1%2Fchallenge-07%2Fchallengestart%2Fchallengestart.json"}},[e("img",{attrs:{src:a(339)}})]),t._v(" to spin up a new VM for this lab.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Name")]),t._v(" "),e("th",[t._v("Value")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("em",[t._v("Resource group")])]),t._v(" "),e("td",[t._v("e.g. rg-www-test-001")])]),t._v(" "),e("tr",[e("td",[e("em",[t._v("Location")])]),t._v(" "),e("td",[t._v("e.g. North Europe")])]),t._v(" "),e("tr",[e("td",[e("em",[t._v("Admin user")])]),t._v(" "),e("td",[t._v("demoadmin")])]),t._v(" "),e("tr",[e("td",[e("em",[t._v("Admin password")])]),t._v(" "),e("td",[t._v("%complex enough%")])]),t._v(" "),e("tr",[e("td",[e("em",[t._v("Vm Size")])]),t._v(" "),e("td",[t._v("e.g.  Standard_F2s_v2")])]),t._v(" "),e("tr",[e("td",[e("em",[t._v("Disk Sku")])]),t._v(" "),e("td",[t._v("StandardSSD_LRS")])])])]),t._v(" "),e("h2",{attrs:{id:"attach-a-simple-helloworld-custom-script-extension-cse-to-a-vm-using-the-portal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#attach-a-simple-helloworld-custom-script-extension-cse-to-a-vm-using-the-portal"}},[t._v("#")]),t._v(" Attach a simple HelloWorld Custom Script Extension (CSE) to a VM using the Portal")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Take the following code and copy & paste it into a file named e.g. '"),e("em",[t._v("HelloWorld.ps1")]),t._v("':")]),t._v(" "),e("div",{staticClass:"language-PowerShell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##############################################")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   HelloWorld Custom Script Extension (CSE)")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##############################################")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filePath")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c:\\temp\\CSEwasRunAt.txt"')]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#create dir if it doesn't exist")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Test-Path")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Path "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Split-Path")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filePath")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Parent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("mkdir "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Split-Path")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filePath")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Parent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#write current time to file.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Date")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Out-File")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filePath")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Append\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#This is really simple but imagine what else you can do to customize a vm ...")]),t._v("\n\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Upload this file to a storage account")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[Azure Portal] \n-> Resource Group \n-> rg-www-test... \n-> sawww... (_your storage account_)  \n-> containers \n-> 'csescripts' \n-> Upload  \n->File \"HelloWorld.ps1\" \n-> Upload\n")])])]),e("p",[e("img",{attrs:{src:a(340),alt:"Upload CSE script to storage account"}})])]),t._v(" "),e("li",[e("p",[t._v("Make this file being executed by the Custom Script Extension within the the VM:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[Azure Portal] \n-> Home \n-> Search 'virtual machines' \n-> 'vmblue'  \n-> Extensions \n-> Add \n-> 'Custom Script Extension' \n-> Create\n")])])]),e("table",[e("thead",[e("tr",[e("th",[t._v("Parameter")]),t._v(" "),e("th",[t._v("Action")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("em",[t._v("Script file (Required)")])]),t._v(" "),e("td",[t._v("Browse to your '"),e("em",[t._v("HelloWorld.ps1")]),t._v("' -> it is in your storage account 'sawww...' -> csescripts")])]),t._v(" "),e("tr",[e("td",[e("em",[t._v("Arguments (Optional)")])]),t._v(" "),e("td",[t._v("none")])])])])]),t._v(" "),e("li",[e("p",[t._v("Wait some seconds then do a refresh of your browser - it'll show the progress:")]),t._v(" "),e("p",[e("img",{attrs:{src:a(341),alt:"Reload the page"}})])]),t._v(" "),e("li",[e("p",[t._v("Final result should show a success:")]),t._v(" "),e("p",[e("img",{attrs:{src:a(342),alt:"Result"}})])])]),t._v(" "),e("h2",{attrs:{id:"see-what-has-happened-inside-the-vm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#see-what-has-happened-inside-the-vm"}},[t._v("#")]),t._v(" See what has happened inside the VM")]),t._v(" "),e("p",[t._v("Now we RDP into the VM and see what has happened and where to find logs in case something breaks.")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[Azure Portal] \n-> Resource Groups \n-> 'rg-www...' \n-> 'vmblue' \n-> Connect \n-> Download RDP file \n-> Open \n-> Connect\n")])])]),e("table",[e("thead",[e("tr",[e("th",[t._v("Parameter")]),t._v(" "),e("th",[t._v("Value")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("em",[t._v("User")])]),t._v(" "),e("td",[t._v("demouser")])]),t._v(" "),e("tr",[e("td",[e("em",[t._v("Password")])]),t._v(" "),e("td",[t._v("%Your Password%")])])])]),t._v(" "),e("p",[t._v("Within the VM:")]),t._v(" "),e("ol",[e("li",[t._v("Navigate to "),e("code",[t._v("C:\\temp")]),t._v(". The result should look similar to this:")])]),t._v(" "),e("p",[e("img",{attrs:{src:a(343),alt:"CSE Result"}})]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[t._v("Navigate to "),e("code",[t._v("C:\\Packages\\Plugins\\Microsoft.Compute.CustomScriptExtension\\ _%version%_\\Downloads")]),t._v(". The CSE is software that runs within the VM. The script that will be executed is downloaded first to this location. If you don't see your script file CSE might have trouble to download the resource.")])]),t._v(" "),e("p",[e("img",{attrs:{src:a(344),alt:"CSE Download Folder"}})]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[t._v("Navigate to "),e("code",[t._v("C:\\WindowsAzure\\Logs\\Plugins\\Microsoft.Compute.CustomScriptExtension\\ _%version%_")]),t._v(" This is the place where the CSE logs its actions locally - a good place to start troubleshooting.")])]),t._v(" "),e("p",[e("img",{attrs:{src:a(345),alt:"CSE Logs Folder"}})]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[t._v("Remove the CSE from the VM")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[Azure Portal] \n-> Home \n-> Search 'virtual machines' \n-> 'vmblue' \n-> 'Custom Script Extension' \n-> 'Uninstall'\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("📝You can only have one Custom Script Extension attached to a VM at a time. If you want to process multiple CSE scripts you need to: "),e("code",[t._v("Install CSE ('Script1') -> deinstall CSE -> Install CSE ('Script2') -> deinstall ->...")])])]),t._v(" "),e("h2",{attrs:{id:"attaching-a-cse-to-a-vm-in-an-arm-template-optional"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#attaching-a-cse-to-a-vm-in-an-arm-template-optional"}},[t._v("#")]),t._v(" Attaching a CSE to a VM in an ARM Template (optional)")]),t._v(" "),e("p",[t._v("The goal of this action is to learn how to avoid the portal, i.e. so that the CSE can be attached to a VM during deployment time e.g. using an ARM template. With the whole setup Azure + VM Settings can be done in a '"),e("em",[t._v("0 touch way")]),t._v("'.")]),t._v(" "),e("ol",[e("li",[e("p",[t._v('In the next CSE we want to install Internet Information Services (IIS) in the VM. Take a look at the code file first ("'),e("a",{attrs:{href:"https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-07/scripts/CSE_Install-IIS.ps1",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSE_Install-IIS.ps1"),e("OutboundLink")],1),t._v('"). The relevant parts starts at '),e("em",[t._v("#region install IIS features")]),t._v(".")])]),t._v(" "),e("li",[e("p",[t._v("When automating CSE e.g. through ARM deployment - the CSE needs a valid download location for the code file ("),e("code",[t._v("CSE_Install-IIS.ps1")]),t._v('). This could be e.g. a public github repo or another https-reachable location. In this lab we use a storage account for this. Upload ("'),e("a",{attrs:{href:"https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-07/scripts/CSE_Install-IIS.ps1",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSE_Install-IIS.ps1"),e("OutboundLink")],1),t._v('") file to a storage account.')])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[Azure Portal] -> Resource Group -> rg-www -> sawww... (%your storage account%)  -> containers -> 'csescripts' -> Upload ->File \"CSE_Install-IIS.ps1\" -> Upload\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("Edit the CSE ARM template to use the correct scripts location. Once uploaded you can copy the blobs URL from the Azure portal")])]),t._v(" "),e("p",[e("img",{attrs:{src:a(346),alt:"Copy the URL of the IIS install script"}})]),t._v(" "),e("blockquote",[e("p",[t._v("❔ "),e("strong",[t._v("Question")]),t._v(" Can you download the file in your browser using the URL? If not have you set the correct access level at the container?")])]),t._v(" "),e("p",[t._v("Edit this: "),e("a",{attrs:{href:"https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-07/scripts/ARMCSE.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSE ARM template"),e("OutboundLink")],1),t._v(" template to use the scripts location:")]),t._v(" "),e("p",[e("img",{attrs:{src:a(347),alt:"Edit following ARM section"}})]),t._v(" "),e("p",[t._v("with your value")]),t._v(" "),e("div",{staticClass:"language-PowerShell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fileUris"')]),t._v(": "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://sawww....blob.core.windows.net/cse/CSE_Install-IIS.ps1"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),e("p",[t._v("Copy the template into the clipboard.")]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[t._v("Deploy the ARM Template.")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[Azure Portal] \n-> Resource Groups \n-> 'rg-www' -> '+' \n-> Template deployment \n-> \"Build your own template in the editor\" \n-> Paste the clipboard\n")])])]),e("p",[t._v("Select the right resource group and VM and deploy:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Name")]),t._v(" "),e("th",[t._v("Value")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("em",[t._v("Resource group")])]),t._v(" "),e("td",[t._v("e.g. rg-www-test-001")])]),t._v(" "),e("tr",[e("td",[e("em",[t._v("Region")])]),t._v(" "),e("td",[t._v("e.g. North Europe")])]),t._v(" "),e("tr",[e("td",[e("em",[t._v("VM name")])]),t._v(" "),e("td",[t._v("vmblue")])])])]),t._v(" "),e("p",[t._v("Deployment will take some minutes: A role is installed and an IIS feature is downloaded and installed.")]),t._v(" "),e("ol",{attrs:{start:"5"}},[e("li",[t._v("At the end the result should look like this:")])]),t._v(" "),e("p",[e("img",{attrs:{src:a(348),alt:"CSE deployment"}})]),t._v(" "),e("p",[t._v("Now you have a web server in your VM - you should test by browsing to the public IP address:")]),t._v(" "),e("p",[e("img",{attrs:{src:a(349),alt:"Running IIS"}})]),t._v(" "),e("h2",{attrs:{id:"cleanup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cleanup"}},[t._v("#")]),t._v(" Cleanup")]),t._v(" "),e("p",[t._v("Cleanup by deleting the resource group.")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[Azure Portal] \n-> Resource Groups \n-> 'rg-www' \n-> 'Delete resource group'\n")])])]),e("p",[e("RouterLink",{attrs:{to:"/day1/challenge-06/"}},[t._v("◀ Previous challenge")]),t._v(" | "),e("RouterLink",{attrs:{to:"/day1/"}},[t._v("🔼 Day 1")]),t._v(" | "),e("RouterLink",{attrs:{to:"/day1/challenge-08/"}},[t._v("Next challenge ▶")])],1)])}),[],!1,null,null,null);e.default=n.exports}}]);