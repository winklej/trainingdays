<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Challenge 3: Storage Account - Creating Data Storage for VMs and Applications | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.8d7a09fd.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.e8a6fdbf.js" as="script"><link rel="preload" href="/trainingdays/assets/js/3.9b3cf7d1.js" as="script"><link rel="preload" href="/trainingdays/assets/js/13.968f15e4.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.5e63eee4.js"><link rel="prefetch" href="/trainingdays/assets/js/11.52cdb15c.js"><link rel="prefetch" href="/trainingdays/assets/js/12.dd68cce1.js"><link rel="prefetch" href="/trainingdays/assets/js/14.6107e61f.js"><link rel="prefetch" href="/trainingdays/assets/js/15.74de6942.js"><link rel="prefetch" href="/trainingdays/assets/js/16.bf550880.js"><link rel="prefetch" href="/trainingdays/assets/js/17.25c2442d.js"><link rel="prefetch" href="/trainingdays/assets/js/18.df448a3a.js"><link rel="prefetch" href="/trainingdays/assets/js/19.57fc59b2.js"><link rel="prefetch" href="/trainingdays/assets/js/2.5f4f93ed.js"><link rel="prefetch" href="/trainingdays/assets/js/20.b16a4364.js"><link rel="prefetch" href="/trainingdays/assets/js/21.f120af84.js"><link rel="prefetch" href="/trainingdays/assets/js/22.a29f663d.js"><link rel="prefetch" href="/trainingdays/assets/js/23.2e9fa4d5.js"><link rel="prefetch" href="/trainingdays/assets/js/24.df3c97d4.js"><link rel="prefetch" href="/trainingdays/assets/js/25.d7157d1b.js"><link rel="prefetch" href="/trainingdays/assets/js/26.8b935eca.js"><link rel="prefetch" href="/trainingdays/assets/js/27.fab398a7.js"><link rel="prefetch" href="/trainingdays/assets/js/28.f45e3c7c.js"><link rel="prefetch" href="/trainingdays/assets/js/29.1ebc26ec.js"><link rel="prefetch" href="/trainingdays/assets/js/30.6728cb2f.js"><link rel="prefetch" href="/trainingdays/assets/js/31.0447b951.js"><link rel="prefetch" href="/trainingdays/assets/js/32.7ba3de54.js"><link rel="prefetch" href="/trainingdays/assets/js/33.1886053c.js"><link rel="prefetch" href="/trainingdays/assets/js/34.71397a5c.js"><link rel="prefetch" href="/trainingdays/assets/js/35.3f4903ee.js"><link rel="prefetch" href="/trainingdays/assets/js/36.ca5c6cd3.js"><link rel="prefetch" href="/trainingdays/assets/js/37.150f3aea.js"><link rel="prefetch" href="/trainingdays/assets/js/38.267b0401.js"><link rel="prefetch" href="/trainingdays/assets/js/39.b63e5745.js"><link rel="prefetch" href="/trainingdays/assets/js/4.51ff6f02.js"><link rel="prefetch" href="/trainingdays/assets/js/40.ccce5e2d.js"><link rel="prefetch" href="/trainingdays/assets/js/41.8d1a41f2.js"><link rel="prefetch" href="/trainingdays/assets/js/42.b2565944.js"><link rel="prefetch" href="/trainingdays/assets/js/43.b9bb36ce.js"><link rel="prefetch" href="/trainingdays/assets/js/44.0cb215c3.js"><link rel="prefetch" href="/trainingdays/assets/js/45.ed0b28e2.js"><link rel="prefetch" href="/trainingdays/assets/js/46.d7dc415d.js"><link rel="prefetch" href="/trainingdays/assets/js/47.94e659f8.js"><link rel="prefetch" href="/trainingdays/assets/js/48.22da67bb.js"><link rel="prefetch" href="/trainingdays/assets/js/49.d0cc21bd.js"><link rel="prefetch" href="/trainingdays/assets/js/5.8a1a1dd9.js"><link rel="prefetch" href="/trainingdays/assets/js/50.fc76ce90.js"><link rel="prefetch" href="/trainingdays/assets/js/51.49e6933d.js"><link rel="prefetch" href="/trainingdays/assets/js/52.b3007d12.js"><link rel="prefetch" href="/trainingdays/assets/js/53.ce74ac77.js"><link rel="prefetch" href="/trainingdays/assets/js/54.0ae1433b.js"><link rel="prefetch" href="/trainingdays/assets/js/55.84f6f655.js"><link rel="prefetch" href="/trainingdays/assets/js/56.8abf9a8b.js"><link rel="prefetch" href="/trainingdays/assets/js/57.5f879cc0.js"><link rel="prefetch" href="/trainingdays/assets/js/58.143be8bb.js"><link rel="prefetch" href="/trainingdays/assets/js/59.48d8acfe.js"><link rel="prefetch" href="/trainingdays/assets/js/6.49058ca4.js"><link rel="prefetch" href="/trainingdays/assets/js/60.a173b602.js"><link rel="prefetch" href="/trainingdays/assets/js/61.04f45b6d.js"><link rel="prefetch" href="/trainingdays/assets/js/62.c3ecf647.js"><link rel="prefetch" href="/trainingdays/assets/js/63.ad717965.js"><link rel="prefetch" href="/trainingdays/assets/js/64.3e451a8e.js"><link rel="prefetch" href="/trainingdays/assets/js/65.a310d4e8.js"><link rel="prefetch" href="/trainingdays/assets/js/66.91ad5d91.js"><link rel="prefetch" href="/trainingdays/assets/js/67.bdfc270a.js"><link rel="prefetch" href="/trainingdays/assets/js/68.7805630f.js"><link rel="prefetch" href="/trainingdays/assets/js/69.9a6edb47.js"><link rel="prefetch" href="/trainingdays/assets/js/7.3ee5fb68.js"><link rel="prefetch" href="/trainingdays/assets/js/70.2e5214af.js"><link rel="prefetch" href="/trainingdays/assets/js/71.0ed1ea53.js"><link rel="prefetch" href="/trainingdays/assets/js/72.05b27471.js"><link rel="prefetch" href="/trainingdays/assets/js/73.5cd028ca.js"><link rel="prefetch" href="/trainingdays/assets/js/74.cd61fe8d.js"><link rel="prefetch" href="/trainingdays/assets/js/75.8c8f40ca.js"><link rel="prefetch" href="/trainingdays/assets/js/76.50f7afaf.js"><link rel="prefetch" href="/trainingdays/assets/js/77.a0e160e0.js"><link rel="prefetch" href="/trainingdays/assets/js/78.c8465bf5.js"><link rel="prefetch" href="/trainingdays/assets/js/79.458fd2c0.js"><link rel="prefetch" href="/trainingdays/assets/js/8.3f86f0a0.js"><link rel="prefetch" href="/trainingdays/assets/js/80.454f4426.js"><link rel="prefetch" href="/trainingdays/assets/js/81.ed2d010d.js"><link rel="prefetch" href="/trainingdays/assets/js/82.cd4bb1c0.js"><link rel="prefetch" href="/trainingdays/assets/js/83.e3b63896.js"><link rel="prefetch" href="/trainingdays/assets/js/84.af75ea47.js"><link rel="prefetch" href="/trainingdays/assets/js/85.728f265c.js"><link rel="prefetch" href="/trainingdays/assets/js/86.e93b6d39.js"><link rel="prefetch" href="/trainingdays/assets/js/87.d5748615.js"><link rel="prefetch" href="/trainingdays/assets/js/9.b9da79d5.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.8d7a09fd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" aria-current="page" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 DevOps and Monitoring</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="challenge-3-storage-account-creating-data-storage-for-vms-and-applications"><a href="#challenge-3-storage-account-creating-data-storage-for-vms-and-applications" class="header-anchor">#</a> Challenge 3: Storage Account - Creating Data Storage for VMs and Applications</h1> <h2 id="here-is-what-you-will-learn-🎯"><a href="#here-is-what-you-will-learn-🎯" class="header-anchor">#</a> Here is what you will learn 🎯</h2> <ul><li>how to create an Azure storage account using the portal for the use as a 'cloud file share'</li> <li>enable 'secured' access to the storage account data (e.g. blobs) using Shared Access Signatures</li> <li>create a SAS policy to enable permission modification after SAS tokens have been issued.</li> <li>use AAD credentials as 'better' way for storage account authorization</li> <li>create a file share and attach it to your Azure virtual machine</li></ul> <h2 id="table-of-contents"><a href="#table-of-contents" class="header-anchor">#</a> Table of Contents</h2> <ol><li><a href="#create-a-storage-account-and-a-container-using-the-azure-portal">Create a storage account and a container using the Azure portal</a></li> <li><a href="#authorize-access-to-blobs-using-aad-optional">Authorize access to blobs using AAD (optional)</a></li> <li><a href="#add-an-azure-file-share-to-a-server">Add an Azure file share to a server</a></li> <li><a href="#cleanup">Cleanup</a></li></ol> <h2 id="create-a-storage-account-and-a-container-using-the-azure-portal"><a href="#create-a-storage-account-and-a-container-using-the-azure-portal" class="header-anchor">#</a> Create a storage account and a container using the Azure portal</h2> <ol><li>Login to your Azure subscription and search the marketplace for 'Storage Account'</li></ol> <p><img src="/trainingdays/assets/img/sa01.cec7e9d6.png" alt="Storage Account Marketplace Item"></p> <ol start="2"><li>Create a storage account with the following values:</li></ol> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Resource Group</em></td> <td><strong>(new)</strong> rg-sachallenge</td></tr> <tr><td><em>Storage account name</em></td> <td>%unique lowercase value%</td></tr> <tr><td><em>Location</em></td> <td>West Europe</td></tr> <tr><td><em>Account kind</em></td> <td>StorageV2</td></tr> <tr><td><em>Performance</em></td> <td>Standard</td></tr> <tr><td>_Replication:</td> <td>Locally-redundant storage (LRS)</td></tr> <tr><td><em>Access tier</em></td> <td>Hot</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 Find some use cases for <a href="https://docs.microsoft.com/azure/storage/common/storage-sas-overview#when-to-use-a-shared-access-signature" target="_blank" rel="noopener noreferrer">SAS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <ol start="3"><li>Once the storage account is created,  generate a new container within the storage account:</li></ol> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] -&gt; %Your Storage Account% -&gt; Containers -&gt; &quot;+ Container&quot;
</code></pre></div><table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Name</em></td> <td>secured</td></tr> <tr><td><em>Public access level</em></td> <td>Private (no anonymous access)</td></tr></tbody></table> <ol start="4"><li>Now upload a small file:</li></ol> <p><img src="/trainingdays/assets/img/sa02.8782fad6.png" alt="Upload a txt file to a storage account"></p> <blockquote><p>❔ <strong>Question:</strong> Can you download the file using its URI in another browser session?</p> <p><img src="/trainingdays/assets/img/sa03.697ed887.png" alt="Download URI"></p> <p><strong>Answer:</strong> No. Because anonymous access is not allowed and this URI does not contain any auth token</p> <p><img src="/trainingdays/assets/img/downloadError.28c3e318.png" alt="Download error"></p></blockquote> <ol start="5"><li>Create a Shared Access Signature via the portal to enable blob access:</li></ol> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; %Your Storage Account% 
-&gt; Shared access signature 
-&gt; &quot;Generate SAS and connection string&quot;
</code></pre></div><ol start="6"><li>Copy the Blob Service SAS URL to the clipboard</li></ol> <p><img src="/trainingdays/assets/img/sas01.b253422a.png" alt="SAS URL"></p> <ol start="7"><li>In the result copy the SAS token:</li></ol> <p><img src="/trainingdays/assets/img/sas02.901c167f.png" alt="SAS URL"></p> <p>and edit the SAS URL: You need to add the path to uploaded file - it should look similar to:</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">https</span><span class="token punctuation">:</span><span class="token header-value">//**%Your Storage Account Name%**.blob.core.windows.net/**secured/HelloWorld.txt**?sv=2019-02-02&amp;ss=bfqt&amp;srt=sco&amp;sp=rwdlacup&amp;se=2020-01-26T00:03:42Z&amp;st=2020-01-25T16:03:42Z&amp;spr=https&amp;sig=Pehc....  </span></span>
</code></pre></div><blockquote><p>❔ <strong>Question:</strong> Can you now download the file in the browser [Yes]<br> <img src="data:image/png;base64,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" alt="Download with edited URI works"></p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 If a SAS:</p> <ul><li>is leaked, it can be used by anyone who obtains it, which can potentially compromise your storage account.</li> <li>is provided to a client application expires and the application is unable to retrieve a new SAS from your service, then the application's functionality may be hindered.</li></ul></div> <ol start="8"><li>Revoke the storage account's access key1 (optional)</li></ol> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; %Your Storage Account% 
-&gt; Access keys 
-&gt; key1 
-&gt; 'regenerate' 
</code></pre></div><blockquote><p>❔ <strong>Questions:</strong></p> <ul><li>Can you still download the file in the browser using aboves URL [No]</li> <li>Why? [Because the SAS key was generated using the previous key1 -&gt; which is no longer valid.]</li></ul></blockquote> <h3 id="create-a-stored-access-policy-to-control-permissions-after-sas-token-is-issued"><a href="#create-a-stored-access-policy-to-control-permissions-after-sas-token-is-issued" class="header-anchor">#</a> Create a stored access policy to control permissions after SAS token is issued</h3> <ol><li>Define a stored access policy ('mypolicy') on the container &quot;secured&quot; (write)</li></ol> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; %Your Storage Account% 
-&gt; Containers 
-&gt; 'secured' 
-&gt; Access policy 
-&gt; 'Stored access policy' 
-&gt; '+' Add policy
</code></pre></div><table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Identifier</em></td> <td>securedap</td></tr> <tr><td><em>Permissions</em></td> <td>Write</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝Don't forget to use the <strong>save</strong> button!</p> <p><img src="/trainingdays/assets/img/saaccpol01.ce54cb25.png" alt="Access policy"></p></div> <ol start="2"><li>Create a SAS URL that is using this access policy using Azure Storage Explorer
2.1 Open <a href="https://azure.microsoft.com/features/storage-explorer/" target="_blank" rel="noopener noreferrer">Microsoft Azure Storage Explorer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://github.com/azuredevcollege/trainingdays/blob/master/day2/challenges/00-challenge-setup.md" target="_blank" rel="noopener noreferrer">See Also Day 2: Challenge 0 - Setup your System<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
2.2 Navigate to your storage account and container.<br>
2.3 Right click and do 'Get Shared Access Signature' based on our policy.</li></ol> <p><img src="/trainingdays/assets/img/saaccpol02.aacd830a.png" alt="Storage Explorer generate SAS URI"><br>
2.4 Copy the URI to the clipboard.<br>
2.5 Edit the SAS URI -&gt; add the path to uploaded file</p> <blockquote><p>❔ <strong>Question:</strong> Can you now download the file in the browser? [No]</p></blockquote> <p>2.5 Edit the stored access policy 'securedap' to allow READ access</p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; %Your Storage Account% 
-&gt; Containers 
-&gt; 'secured' 
-&gt; Access policy 
-&gt; Under 'Stored access policy' 
-&gt; 'securedap' 
-&gt; '...' 
-&gt; Edit 
-&gt; Permissions 
-&gt; Add READ 
-&gt; OK 
-&gt; Save
</code></pre></div><p><img src="data:image/png;base64,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" alt="RW Access Policy"></p> <blockquote><p>❔ <strong>Question:</strong> Can you now download the file in the browser? [Yes]</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 When you now distribute this SAS URI to users or Apps you can later modify it's behavior by modifying the access policy. So stored access policies can help to modify permissions to a container after the SAS has been issued to users / apps.</p></div> <h2 id="authorize-access-to-blobs-using-aad-optional"><a href="#authorize-access-to-blobs-using-aad-optional" class="header-anchor">#</a> Authorize access to blobs using AAD (optional)</h2> <p>You can also authorize access to storage accounts using Azure Active Directory (AAD) credentials (<a href="https://docs.microsoft.com/azure/storage/common/storage-auth-aad?toc=%2fazure%2fstorage%2fblobs%2ftoc.json" target="_blank" rel="noopener noreferrer">documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) which means you assign users RBAC permissions to e.g. a  container. This is in fact the <em>recommended way</em>.</p> <p>However, apps might want to use 'service accounts' as users (aka Service Principals) in Azure. The following PowerShell code creates a Service Principal in AAD. Run this in your cloud shell (How? See <a href="/trainingdays/day1/challenge-02/">challenge 2</a>):</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token variable">$servicePrincipalName</span> = <span class="token string">&quot;myADCServicePrincipal<span class="token function">$<span class="token punctuation">(</span><span class="token function">get-random</span> <span class="token operator">-</span>min 100 <span class="token operator">-</span>max 999<span class="token punctuation">)</span></span>&quot;</span>   <span class="token comment">#must be unique within AAD tenant</span>

<span class="token comment">#using Azure CLI is more comfortable to use for creating a Service Principal</span>
<span class="token variable">$jsonResult</span> = &amp;az ad <span class="token function">sp</span> create-<span class="token keyword">for</span><span class="token operator">-</span>rbac <span class="token operator">--</span>name <span class="token variable">$servicePrincipalName</span> 

<span class="token variable">$SPPassword</span> = <span class="token punctuation">(</span><span class="token variable">$jsonResult</span> <span class="token punctuation">|</span> <span class="token function">convertfrom-json</span><span class="token punctuation">)</span><span class="token punctuation">.</span>password
<span class="token variable">$SPName</span> = <span class="token punctuation">(</span><span class="token variable">$jsonResult</span> <span class="token punctuation">|</span> <span class="token function">convertfrom-json</span><span class="token punctuation">)</span><span class="token punctuation">.</span>displayName

<span class="token comment">#Get your AAD ID</span>
<span class="token variable">$tenantID</span> = $<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">Get-AzContext</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Tenant<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>  <span class="token comment">#e.g. '72f988bf-8.....'</span>

<span class="token function">Write-Host</span> <span class="token string">&quot;You created SP: <span class="token variable">$servicePrincipalName</span> with password: <span class="token variable">$SPPassword</span> in tenant: <span class="token variable">$tenantID</span>&quot;</span> <span class="token operator">-</span>ForegroundColor Cyan  

</code></pre></div><p>Below is some PowerShell Code that simulates your app. It will login to Azure as Service Principal and access the storage account.<br>
Run this in the Cloud Shell:</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token comment">#Now sign in as this service principal</span>
<span class="token variable">$passwd</span> = <span class="token function">ConvertTo-SecureString</span> <span class="token variable">$SPPassword</span> <span class="token operator">-</span>AsPlainText <span class="token operator">-</span>Force
<span class="token variable">$pscredential</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>PSCredential<span class="token punctuation">(</span><span class="token variable">$SPName</span><span class="token punctuation">,</span> <span class="token variable">$passwd</span><span class="token punctuation">)</span>
<span class="token function">Connect-AzAccount</span> <span class="token operator">-</span>ServicePrincipal <span class="token operator">-</span>Credential <span class="token variable">$pscredential</span> <span class="token operator">-</span>Tenant <span class="token variable">$tenantID</span>
</code></pre></div><p>Check if the login worked via:</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code>Account                         SubscriptionName                             TenantId                             Environment
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>                         <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>                             <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>                             <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
http:<span class="token operator">/</span><span class="token operator">/</span>myADCServicePrincipal925 Microsoft Azure <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                       72f988bf-<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                        AzureCloud
</code></pre></div><p>If yes - proceed.</p> <p>You need to give this 'user' or better 'service principal' permissions to your storage account -&gt; container</p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; %Your Storage Account% 
-&gt; Containers 
-&gt; 'secured' 
-&gt;  Access Control (IAM) 
-&gt; Add a role assignment...
    Role: e.g. &quot;Storage Blob Data Contributor&quot;
    Select: &quot;myADCServicePrincipal...&quot;
</code></pre></div><div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token function">Write-Host</span> <span class="token string">&quot;Select the proper storage account&quot;</span> <span class="token operator">-</span>ForegroundColor Blue

<span class="token comment">#select your storage account</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token variable">$saccts</span> = @<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token function">Get-AzResource</span> <span class="token operator">-</span>ResourceType <span class="token string">'Microsoft.Storage/storageAccounts'</span> <span class="token punctuation">|</span> <span class="token keyword">foreach</span> <span class="token operator">-</span><span class="token keyword">Begin</span> <span class="token punctuation">{</span> <span class="token variable">$i</span> = 0 <span class="token punctuation">}</span> <span class="token operator">-</span><span class="token keyword">Process</span> <span class="token punctuation">{</span>
        <span class="token variable">$i</span><span class="token operator">++</span>
        <span class="token variable">$saccts</span> <span class="token operator">+=</span> <span class="token string">&quot;{0}. {1}&quot;</span> <span class="token operator">-</span>f <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token variable">$_</span><span class="token punctuation">.</span>Name
    <span class="token punctuation">}</span> <span class="token operator">-</span>outvariable menu
    <span class="token variable">$saccts</span> <span class="token punctuation">|</span> <span class="token function">Format-Wide</span> <span class="token punctuation">{</span> <span class="token variable">$_</span> <span class="token punctuation">}</span> <span class="token operator">-</span>Column 4 <span class="token operator">-</span>Force
    <span class="token variable">$r</span> = <span class="token function">Read-Host</span> <span class="token string">&quot;Select the storage account&quot;</span>
    <span class="token variable">$SA</span> = <span class="token variable">$saccts</span><span class="token punctuation">[</span><span class="token variable">$r</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$SA</span> <span class="token operator">-eq</span> <span class="token variable">$null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">Write-Host</span> <span class="token string">&quot;You must make a valid selection&quot;</span> <span class="token operator">-</span>ForegroundColor Red <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">&quot;Selecting storage account: <span class="token function">$<span class="token punctuation">(</span><span class="token variable">$saccts</span><span class="token punctuation">[</span><span class="token variable">$r</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>&quot;</span> <span class="token operator">-</span>ForegroundColor Green
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">until</span> <span class="token punctuation">(</span><span class="token variable">$SA</span> <span class="token operator">-ne</span> <span class="token variable">$null</span><span class="token punctuation">)</span>

<span class="token variable">$ctx</span> = <span class="token variable">$null</span>
<span class="token variable">$ctx</span> = <span class="token function">New-AzStorageContext</span> <span class="token operator">-</span>StorageAccountName <span class="token variable">$SA</span> <span class="token operator">-</span>UseConnectedAccount
<span class="token variable">$container</span> = <span class="token function">Get-AzStorageContainer</span> <span class="token operator">-</span>Context <span class="token variable">$ctx</span> <span class="token operator">-</span>Name <span class="token string">'secured'</span>
<span class="token function">Get-AzStorageBlob</span> <span class="token operator">-</span>Container $<span class="token punctuation">(</span><span class="token variable">$container</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">-</span>Context <span class="token variable">$ctx</span>

<span class="token comment">#in case of error - do you have the correct role permissions? (e.g. Storage Blob Data Contributor)</span>
<span class="token comment">#Get-AzRoleAssignment -ServicePrincipalName $SPName</span>

<span class="token comment">#Display the content of the first file</span>
<span class="token variable">$myfiles</span> = <span class="token function">Get-AzStorageBlob</span> <span class="token operator">-</span>Container $<span class="token punctuation">(</span><span class="token variable">$container</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">-</span>Context <span class="token variable">$ctx</span> 
<span class="token variable">$myfile</span> = <span class="token punctuation">(</span><span class="token variable">$myfiles</span> <span class="token punctuation">|</span> <span class="token function">Select-Object</span> <span class="token operator">-</span>First 1<span class="token punctuation">)</span><span class="token punctuation">.</span>Name
<span class="token function">Get-AzStorageBlobContent</span> <span class="token variable">$myfile</span> <span class="token operator">-</span>Force <span class="token operator">-</span>Context <span class="token variable">$ctx</span> <span class="token operator">-</span>container $<span class="token punctuation">(</span><span class="token variable">$container</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token function">Write-Host</span> <span class="token string">&quot;the content....&quot;</span>  <span class="token operator">-</span>ForegroundColor Cyan
<span class="token variable">$content</span> = <span class="token function">get-content</span> <span class="token operator">-</span>path <span class="token variable">$myfile</span>
<span class="token function">Write-Host</span> <span class="token operator">-</span>ForegroundColor DarkYellow <span class="token variable">$content</span>
<span class="token string">&quot;:-)&quot;</span>  

</code></pre></div><p>You now want to delete your service principal? Do this:</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token comment">#cleanup</span>
Logout-AzAccount <span class="token operator">-</span>Username <span class="token variable">$SPName</span> 
<span class="token function">Read-Host</span> <span class="token operator">-</span>Prompt <span class="token string">&quot;Ready to cleanup? (key)&quot;</span>
<span class="token variable">$SPDisplayName</span> = <span class="token punctuation">(</span><span class="token variable">$jsonResult</span> <span class="token punctuation">|</span> <span class="token function">convertfrom-json</span><span class="token punctuation">)</span><span class="token punctuation">.</span>displayName
<span class="token function">Remove-AzADApplication</span> <span class="token operator">-</span>DisplayName <span class="token variable">$SPDisplayName</span> <span class="token operator">-</span>Force
</code></pre></div><h2 id="add-an-azure-file-share-to-a-server"><a href="#add-an-azure-file-share-to-a-server" class="header-anchor">#</a> Add an Azure file share to a server</h2> <h3 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h3> <ol><li><p>Create a VM to attach the file share to if you don't have one. <strong>Click</strong> on the
<a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fazuredevcollege%2Ftrainingdays%2Fmaster%2Fday1%2Fchallenge-03%2Fchallengestart%2Fchallengestart.json"><img src="/trainingdays/assets/img/deploytoazure.e0e5d477.png"></a>
button.</p></li> <li><p>Create a file share via the portal:</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Storage Account 
-&gt; File Shares 
-&gt; &quot;+&quot; File Share
</code></pre></div><table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Name</em></td> <td>myfiles</td></tr> <tr><td><em>Quota</em></td> <td>%empty%</td></tr></tbody></table> <ol start="3"><li>In your Azure VM mount the share as drive by executing the command taken from:</li></ol> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Storage Account 
-&gt; File Shares 
-&gt; 'myfiles' 
-&gt; Connect 
-&gt; copy the code into the clipboard
</code></pre></div><p><img src="/trainingdays/assets/img/azfiles01.c5d3acd2.png" alt="Azure Files">)</p> <ol start="4"><li>In your VM paste the code into a PowerShell window and execute it. Once successful your 'drive' has been mounted:</li></ol> <p><img src="/trainingdays/assets/img/azfiles02.190b6c2a.png" alt="Mounted Azure File Share"></p> <blockquote><p>❔ <strong>Question:</strong></p> <ul><li>What is the default quota of an Azure file share?</li> <li>Which user account is used for establishing the connection?</li> <li>Is the 'drive' available to other users that logon to the VM? [No]</li> <li>Is the 'drive' mounted 'automatically' after a reboot? [Yes]</li> <li>Can I mount a file share located in e.g. North Europe from a machine located in e.g. West Europe [Yes]</li></ul></blockquote> <h2 id="cleanup"><a href="#cleanup" class="header-anchor">#</a> Cleanup</h2> <p>Delete Resource Group <code>rg-sachallenge</code></p> <p><a href="/trainingdays/day1/challenge-02/">◀ Previous challenge</a> | <a href="/trainingdays/day1/" class="router-link-active">🔼 Day 1</a> | <a href="/trainingdays/day1/challenge-04/">Next challenge ▶</a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day1/challenge-03/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.e8a6fdbf.js" defer></script><script src="/trainingdays/assets/js/3.9b3cf7d1.js" defer></script><script src="/trainingdays/assets/js/13.968f15e4.js" defer></script>
  </body>
</html>
