<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Challenge 8: Networking - Distribute traffic across global Azure regions for optimal latency and availability using Traffic Manager | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.8d7a09fd.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.e8a6fdbf.js" as="script"><link rel="preload" href="/trainingdays/assets/js/3.9b3cf7d1.js" as="script"><link rel="preload" href="/trainingdays/assets/js/23.2e9fa4d5.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.5e63eee4.js"><link rel="prefetch" href="/trainingdays/assets/js/11.52cdb15c.js"><link rel="prefetch" href="/trainingdays/assets/js/12.dd68cce1.js"><link rel="prefetch" href="/trainingdays/assets/js/13.968f15e4.js"><link rel="prefetch" href="/trainingdays/assets/js/14.6107e61f.js"><link rel="prefetch" href="/trainingdays/assets/js/15.74de6942.js"><link rel="prefetch" href="/trainingdays/assets/js/16.bf550880.js"><link rel="prefetch" href="/trainingdays/assets/js/17.25c2442d.js"><link rel="prefetch" href="/trainingdays/assets/js/18.df448a3a.js"><link rel="prefetch" href="/trainingdays/assets/js/19.57fc59b2.js"><link rel="prefetch" href="/trainingdays/assets/js/2.5f4f93ed.js"><link rel="prefetch" href="/trainingdays/assets/js/20.b16a4364.js"><link rel="prefetch" href="/trainingdays/assets/js/21.f120af84.js"><link rel="prefetch" href="/trainingdays/assets/js/22.a29f663d.js"><link rel="prefetch" href="/trainingdays/assets/js/24.df3c97d4.js"><link rel="prefetch" href="/trainingdays/assets/js/25.d7157d1b.js"><link rel="prefetch" href="/trainingdays/assets/js/26.8b935eca.js"><link rel="prefetch" href="/trainingdays/assets/js/27.fab398a7.js"><link rel="prefetch" href="/trainingdays/assets/js/28.f45e3c7c.js"><link rel="prefetch" href="/trainingdays/assets/js/29.1ebc26ec.js"><link rel="prefetch" href="/trainingdays/assets/js/30.6728cb2f.js"><link rel="prefetch" href="/trainingdays/assets/js/31.0447b951.js"><link rel="prefetch" href="/trainingdays/assets/js/32.7ba3de54.js"><link rel="prefetch" href="/trainingdays/assets/js/33.1886053c.js"><link rel="prefetch" href="/trainingdays/assets/js/34.71397a5c.js"><link rel="prefetch" href="/trainingdays/assets/js/35.3f4903ee.js"><link rel="prefetch" href="/trainingdays/assets/js/36.ca5c6cd3.js"><link rel="prefetch" href="/trainingdays/assets/js/37.150f3aea.js"><link rel="prefetch" href="/trainingdays/assets/js/38.267b0401.js"><link rel="prefetch" href="/trainingdays/assets/js/39.b63e5745.js"><link rel="prefetch" href="/trainingdays/assets/js/4.51ff6f02.js"><link rel="prefetch" href="/trainingdays/assets/js/40.ccce5e2d.js"><link rel="prefetch" href="/trainingdays/assets/js/41.8d1a41f2.js"><link rel="prefetch" href="/trainingdays/assets/js/42.b2565944.js"><link rel="prefetch" href="/trainingdays/assets/js/43.b9bb36ce.js"><link rel="prefetch" href="/trainingdays/assets/js/44.0cb215c3.js"><link rel="prefetch" href="/trainingdays/assets/js/45.ed0b28e2.js"><link rel="prefetch" href="/trainingdays/assets/js/46.d7dc415d.js"><link rel="prefetch" href="/trainingdays/assets/js/47.94e659f8.js"><link rel="prefetch" href="/trainingdays/assets/js/48.22da67bb.js"><link rel="prefetch" href="/trainingdays/assets/js/49.d0cc21bd.js"><link rel="prefetch" href="/trainingdays/assets/js/5.8a1a1dd9.js"><link rel="prefetch" href="/trainingdays/assets/js/50.fc76ce90.js"><link rel="prefetch" href="/trainingdays/assets/js/51.49e6933d.js"><link rel="prefetch" href="/trainingdays/assets/js/52.b3007d12.js"><link rel="prefetch" href="/trainingdays/assets/js/53.ce74ac77.js"><link rel="prefetch" href="/trainingdays/assets/js/54.0ae1433b.js"><link rel="prefetch" href="/trainingdays/assets/js/55.84f6f655.js"><link rel="prefetch" href="/trainingdays/assets/js/56.8abf9a8b.js"><link rel="prefetch" href="/trainingdays/assets/js/57.5f879cc0.js"><link rel="prefetch" href="/trainingdays/assets/js/58.143be8bb.js"><link rel="prefetch" href="/trainingdays/assets/js/59.48d8acfe.js"><link rel="prefetch" href="/trainingdays/assets/js/6.49058ca4.js"><link rel="prefetch" href="/trainingdays/assets/js/60.a173b602.js"><link rel="prefetch" href="/trainingdays/assets/js/61.04f45b6d.js"><link rel="prefetch" href="/trainingdays/assets/js/62.c3ecf647.js"><link rel="prefetch" href="/trainingdays/assets/js/63.ad717965.js"><link rel="prefetch" href="/trainingdays/assets/js/64.3e451a8e.js"><link rel="prefetch" href="/trainingdays/assets/js/65.a310d4e8.js"><link rel="prefetch" href="/trainingdays/assets/js/66.91ad5d91.js"><link rel="prefetch" href="/trainingdays/assets/js/67.bdfc270a.js"><link rel="prefetch" href="/trainingdays/assets/js/68.7805630f.js"><link rel="prefetch" href="/trainingdays/assets/js/69.9a6edb47.js"><link rel="prefetch" href="/trainingdays/assets/js/7.3ee5fb68.js"><link rel="prefetch" href="/trainingdays/assets/js/70.2e5214af.js"><link rel="prefetch" href="/trainingdays/assets/js/71.0ed1ea53.js"><link rel="prefetch" href="/trainingdays/assets/js/72.05b27471.js"><link rel="prefetch" href="/trainingdays/assets/js/73.5cd028ca.js"><link rel="prefetch" href="/trainingdays/assets/js/74.cd61fe8d.js"><link rel="prefetch" href="/trainingdays/assets/js/75.8c8f40ca.js"><link rel="prefetch" href="/trainingdays/assets/js/76.50f7afaf.js"><link rel="prefetch" href="/trainingdays/assets/js/77.a0e160e0.js"><link rel="prefetch" href="/trainingdays/assets/js/78.c8465bf5.js"><link rel="prefetch" href="/trainingdays/assets/js/79.458fd2c0.js"><link rel="prefetch" href="/trainingdays/assets/js/8.3f86f0a0.js"><link rel="prefetch" href="/trainingdays/assets/js/80.454f4426.js"><link rel="prefetch" href="/trainingdays/assets/js/81.ed2d010d.js"><link rel="prefetch" href="/trainingdays/assets/js/82.cd4bb1c0.js"><link rel="prefetch" href="/trainingdays/assets/js/83.e3b63896.js"><link rel="prefetch" href="/trainingdays/assets/js/84.af75ea47.js"><link rel="prefetch" href="/trainingdays/assets/js/85.728f265c.js"><link rel="prefetch" href="/trainingdays/assets/js/86.e93b6d39.js"><link rel="prefetch" href="/trainingdays/assets/js/87.d5748615.js"><link rel="prefetch" href="/trainingdays/assets/js/9.b9da79d5.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.8d7a09fd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" aria-current="page" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 DevOps and Monitoring</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="challenge-8-networking-distribute-traffic-across-global-azure-regions-for-optimal-latency-and-availability-using-traffic-manager"><a href="#challenge-8-networking-distribute-traffic-across-global-azure-regions-for-optimal-latency-and-availability-using-traffic-manager" class="header-anchor">#</a> Challenge 8: Networking - Distribute traffic across global Azure regions for optimal latency and availability using Traffic Manager</h1> <h2 id="here-is-what-you-will-learn-🎯"><a href="#here-is-what-you-will-learn-🎯" class="header-anchor">#</a> Here is what you will learn 🎯</h2> <ul><li>How to setup Traffic Manager using the Azure portal.</li> <li>Setup 2 endpoints located in 2 Azure regions ('North Europe', 'West Europe')</li> <li>Configure load balancing based on clients origin geography.</li></ul> <p>Our <strong>final architecture</strong> will look like this:
<img src="/trainingdays/assets/img/TMArchitecture.ca56d9d4.png" alt="Final architecture"></p> <p>To speed things up  you will first deploy the <em>start point</em> and then you will add the external <em>Traffic Manager</em>.</p> <h2 id="table-of-contents"><a href="#table-of-contents" class="header-anchor">#</a> Table of Contents</h2> <ol><li><a href="#introduction-traffic-manager">Introduction Traffic Manager</a></li> <li><a href="#deploy-the-starting-point">Deploy the Starting Point</a></li> <li><a href="#deploy-a-traffic-manager-instance">Deploy a Traffic Manager Instance</a></li> <li><a href="#cleanup">Cleanup</a></li></ol> <h2 id="introduction-traffic-manager"><a href="#introduction-traffic-manager" class="header-anchor">#</a> Introduction Traffic Manager</h2> <p>The <a href="https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview" target="_blank" rel="noopener noreferrer">Traffic Manager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> uses DNS to load balance traffic to endpoints across Azure regions. It can help you to:</p> <ul><li><strong>provide optimal latency</strong> by serving clients from the nearest location.</li> <li><strong>increase availability</strong> as it monitors its endpoints and provides failover.</li> <li><strong>redirect traffic</strong> to online endpoints while others are in maintenance.</li></ul> <h2 id="deploy-the-starting-point"><a href="#deploy-the-starting-point" class="header-anchor">#</a> Deploy the Starting Point</h2> <p>Now let's create some VMs using the 'Cloud Shell' in the Azure Portal. When being asked choose <em>PowerShell</em> this time.</p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Click the 'Cloud Shell' symbol close to your login details on the right upper corner
</code></pre></div><p><img src="data:image/png;base64,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" alt="Cloud Shell">)</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝 The 'Cloud Shell' is an in-browser-accessible shell for managing Azure resources. It already has the required SDKs and tools installed to interact with Azure. You can use either Bash or PowerShell.</p></div> <p>The first time you use the 'Cloud Shell' you will be asked to setup a storage account e.g. to store files you have uploaded persistently. See the <a href="https://docs.microsoft.com/azure/cloud-shell/persisting-shell-storage" target="_blank" rel="noopener noreferrer">documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> formore details.</p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] -&gt; Click 'Show advanced settings'
</code></pre></div><p><img src="/trainingdays/assets/img/CloudShell1.af6f63c1.png" alt="Cloud Shell Storage Account Setup"></p> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Subscription</em></td> <td>%Your subscription%</td></tr> <tr><td><em>Cloud Shell Region</em></td> <td>West Europe</td></tr> <tr><td><em>Resource Group</em></td> <td>rg-cloudshell</td></tr> <tr><td><em>Storage Account</em></td> <td>%some unique value%</td></tr> <tr><td><em>File Share</em></td> <td>cloudshell</td></tr></tbody></table> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Create storage
</code></pre></div><p>Once successful your shell should appear at the bottom of the page:</p> <p><img src="/trainingdays/assets/img/CloudShell2.3a511722.png" alt="Cloud Shell in the Azure portal"></p> <p>To setup the starting point, copy &amp; paste the following code into the Cloud Shell:</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token comment">#Creates some resource groups in different Azure regions</span>
<span class="token function">New-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb-NE'</span> <span class="token operator">-</span>Location <span class="token string">'North Europe'</span>
<span class="token function">New-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb-WE'</span> <span class="token operator">-</span>Location <span class="token string">'West Europe'</span>
<span class="token function">New-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb'</span> <span class="token operator">-</span>Location <span class="token string">'North Europe'</span>

<span class="token variable">$TemplateParameters</span> = @<span class="token punctuation">{</span>
    <span class="token string">&quot;adminUser&quot;</span> = <span class="token namespace">[string]</span><span class="token string">'demouser'</span><span class="token punctuation">;</span>
    <span class="token string">&quot;adminPassword&quot;</span> = <span class="token namespace">[System.Security.SecureString]</span><span class="token punctuation">(</span><span class="token function">Read-Host</span> <span class="token operator">-</span>Prompt <span class="token string">&quot;adminUser password please&quot;</span> <span class="token operator">-</span>AsSecureString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token string">&quot;vmNames&quot;</span> = <span class="token namespace">[array]</span>@<span class="token punctuation">(</span><span class="token string">'vmblue'</span><span class="token punctuation">,</span><span class="token string">'vmred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token string">&quot;vmSize&quot;</span> = <span class="token namespace">[string]</span><span class="token string">'Standard_F2s_v2'</span> <span class="token comment"># or 'Standard_B2s'</span>
    <span class="token string">&quot;DiskSku&quot;</span> = <span class="token namespace">[string]</span><span class="token string">'StandardSSD_LRS'</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Enter the password as asked. Then execute the deployment by adding 2 lines</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token comment">#will create some vms in different Azure regions in parallel</span>
<span class="token function">New-AzResourceGroupDeployment</span> <span class="token operator">-</span>Name <span class="token string">'NE'</span> <span class="token operator">-</span>TemplateUri <span class="token string">&quot;https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-08/challengestart/challengestart.json&quot;</span> <span class="token operator">-</span>ResourceGroupName <span class="token string">'rg-wwwlb-NE'</span> <span class="token operator">-</span>TemplateParameterObject <span class="token variable">$TemplateParameters</span> <span class="token operator">-</span>AsJob

<span class="token variable">$TemplateParameters</span><span class="token punctuation">.</span>vmNames = @<span class="token punctuation">(</span><span class="token string">'vmyellow'</span><span class="token punctuation">,</span><span class="token string">'vmgreen'</span><span class="token punctuation">)</span>
<span class="token function">New-AzResourceGroupDeployment</span> <span class="token operator">-</span>Name <span class="token string">'WE'</span> <span class="token operator">-</span>TemplateUri <span class="token string">&quot;https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-08/challengestart/challengestart.json&quot;</span> <span class="token operator">-</span>ResourceGroupName <span class="token string">'rg-wwwlb-WE'</span> <span class="token operator">-</span>TemplateParameterObject <span class="token variable">$TemplateParameters</span> <span class="token operator">-</span>AsJob  

<span class="token comment">#wait until both deployments are done</span>
<span class="token function">get-job</span> <span class="token operator">-</span>State Running <span class="token punctuation">|</span> <span class="token function">wait-job</span>  

</code></pre></div><h2 id="deploy-a-traffic-manager-instance"><a href="#deploy-a-traffic-manager-instance" class="header-anchor">#</a> Deploy a Traffic Manager Instance</h2> <p>Add the <a href="https://docs.microsoft.com/azure/traffic-manager/quickstart-create-traffic-manager-profile#add-traffic-manager-endpoints" target="_blank" rel="noopener noreferrer">Traffic Manager Profile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in resource group <code>rg-wwwlb</code> with a routing method based on e.g. performance.</p> <p>Add 2 endpoints to the traffic manager.</p> <ul><li><p>Endpoint 1</p> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Type</em></td> <td>Azure endpoint</td></tr> <tr><td><em>Name</em></td> <td>Dublin</td></tr> <tr><td><em>Target resource type</em></td> <td>Public IP address</td></tr> <tr><td><em>Public IP address</em></td> <td>pip-wwwlb-NE</td></tr></tbody></table></li> <li><p>Endpoint 2</p> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Type</em></td> <td>Azure endpoint</td></tr> <tr><td><em>Name</em></td> <td>Amsterdam</td></tr> <tr><td><em>Target resource type</em></td> <td>Public IP address</td></tr> <tr><td><em>Public IP address</em></td> <td>pip-wwwlb-WE</td></tr></tbody></table></li></ul> <p>Now test by opening the traffic managers DNS name in your browser (you might need to open multiple different browsers to see some change):</p> <table><thead><tr><th><img src="/trainingdays/assets/img/testvmyellow.aea3026f.png" alt="VM Yellow"></th> <th><img src="/trainingdays/assets/img/testvmgreen.12c7f72b.png" alt="VM Green"></th> <th><img src="/trainingdays/assets/img/testvmblue.c0cd4c61.png" alt="VM Blue"></th> <th><img src="/trainingdays/assets/img/testvmred.e245166e.png" alt="VM Red"></th></tr></thead> <tbody><tr><td>vmyellow (Amsterdam)</td> <td>vmgreen (Amsterdam)</td> <td>vmblue (Dublin)</td> <td>vmred (Dublin)</td></tr></tbody></table> <h2 id="cleanup"><a href="#cleanup" class="header-anchor">#</a> Cleanup</h2> <p>Delete the resource groups <code>rg-wwwlb....</code> or execute the following commands in the Cloud Shell:</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token function">Remove-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb-NE'</span> <span class="token operator">-</span>Force <span class="token operator">-</span>AsJob
<span class="token function">Remove-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb-WE'</span> <span class="token operator">-</span>Force <span class="token operator">-</span>AsJob
<span class="token function">Remove-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb'</span>    <span class="token operator">-</span>Force <span class="token operator">-</span>AsJob

<span class="token function">Get-Job</span> <span class="token operator">-</span>State Running <span class="token punctuation">|</span> <span class="token function">Wait-Job</span>
</code></pre></div><p><a href="/trainingdays/day1/challenge-07/">◀ Previous challenge</a> | <a href="/trainingdays/day1/" class="router-link-active">🔼 Day 1</a> | <a href="/trainingdays/day1/challenge-09/">Next challenge ▶</a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day1/challenge-08/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.e8a6fdbf.js" defer></script><script src="/trainingdays/assets/js/3.9b3cf7d1.js" defer></script><script src="/trainingdays/assets/js/23.2e9fa4d5.js" defer></script>
  </body>
</html>
