<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Challenge 7 (optional): VM and Custom Script Extensions - Post deployment automation  or configure / setup / install something within an empty vm | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.8d7a09fd.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.e8a6fdbf.js" as="script"><link rel="preload" href="/trainingdays/assets/js/3.9b3cf7d1.js" as="script"><link rel="preload" href="/trainingdays/assets/js/16.bf550880.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.5e63eee4.js"><link rel="prefetch" href="/trainingdays/assets/js/11.52cdb15c.js"><link rel="prefetch" href="/trainingdays/assets/js/12.dd68cce1.js"><link rel="prefetch" href="/trainingdays/assets/js/13.968f15e4.js"><link rel="prefetch" href="/trainingdays/assets/js/14.6107e61f.js"><link rel="prefetch" href="/trainingdays/assets/js/15.74de6942.js"><link rel="prefetch" href="/trainingdays/assets/js/17.25c2442d.js"><link rel="prefetch" href="/trainingdays/assets/js/18.df448a3a.js"><link rel="prefetch" href="/trainingdays/assets/js/19.57fc59b2.js"><link rel="prefetch" href="/trainingdays/assets/js/2.5f4f93ed.js"><link rel="prefetch" href="/trainingdays/assets/js/20.b16a4364.js"><link rel="prefetch" href="/trainingdays/assets/js/21.f120af84.js"><link rel="prefetch" href="/trainingdays/assets/js/22.a29f663d.js"><link rel="prefetch" href="/trainingdays/assets/js/23.2e9fa4d5.js"><link rel="prefetch" href="/trainingdays/assets/js/24.df3c97d4.js"><link rel="prefetch" href="/trainingdays/assets/js/25.d7157d1b.js"><link rel="prefetch" href="/trainingdays/assets/js/26.8b935eca.js"><link rel="prefetch" href="/trainingdays/assets/js/27.fab398a7.js"><link rel="prefetch" href="/trainingdays/assets/js/28.f45e3c7c.js"><link rel="prefetch" href="/trainingdays/assets/js/29.1ebc26ec.js"><link rel="prefetch" href="/trainingdays/assets/js/30.6728cb2f.js"><link rel="prefetch" href="/trainingdays/assets/js/31.0447b951.js"><link rel="prefetch" href="/trainingdays/assets/js/32.7ba3de54.js"><link rel="prefetch" href="/trainingdays/assets/js/33.1886053c.js"><link rel="prefetch" href="/trainingdays/assets/js/34.71397a5c.js"><link rel="prefetch" href="/trainingdays/assets/js/35.3f4903ee.js"><link rel="prefetch" href="/trainingdays/assets/js/36.ca5c6cd3.js"><link rel="prefetch" href="/trainingdays/assets/js/37.150f3aea.js"><link rel="prefetch" href="/trainingdays/assets/js/38.267b0401.js"><link rel="prefetch" href="/trainingdays/assets/js/39.b63e5745.js"><link rel="prefetch" href="/trainingdays/assets/js/4.51ff6f02.js"><link rel="prefetch" href="/trainingdays/assets/js/40.ccce5e2d.js"><link rel="prefetch" href="/trainingdays/assets/js/41.8d1a41f2.js"><link rel="prefetch" href="/trainingdays/assets/js/42.b2565944.js"><link rel="prefetch" href="/trainingdays/assets/js/43.b9bb36ce.js"><link rel="prefetch" href="/trainingdays/assets/js/44.0cb215c3.js"><link rel="prefetch" href="/trainingdays/assets/js/45.ed0b28e2.js"><link rel="prefetch" href="/trainingdays/assets/js/46.d7dc415d.js"><link rel="prefetch" href="/trainingdays/assets/js/47.94e659f8.js"><link rel="prefetch" href="/trainingdays/assets/js/48.22da67bb.js"><link rel="prefetch" href="/trainingdays/assets/js/49.d0cc21bd.js"><link rel="prefetch" href="/trainingdays/assets/js/5.8a1a1dd9.js"><link rel="prefetch" href="/trainingdays/assets/js/50.fc76ce90.js"><link rel="prefetch" href="/trainingdays/assets/js/51.49e6933d.js"><link rel="prefetch" href="/trainingdays/assets/js/52.b3007d12.js"><link rel="prefetch" href="/trainingdays/assets/js/53.ce74ac77.js"><link rel="prefetch" href="/trainingdays/assets/js/54.0ae1433b.js"><link rel="prefetch" href="/trainingdays/assets/js/55.84f6f655.js"><link rel="prefetch" href="/trainingdays/assets/js/56.8abf9a8b.js"><link rel="prefetch" href="/trainingdays/assets/js/57.5f879cc0.js"><link rel="prefetch" href="/trainingdays/assets/js/58.143be8bb.js"><link rel="prefetch" href="/trainingdays/assets/js/59.48d8acfe.js"><link rel="prefetch" href="/trainingdays/assets/js/6.49058ca4.js"><link rel="prefetch" href="/trainingdays/assets/js/60.a173b602.js"><link rel="prefetch" href="/trainingdays/assets/js/61.04f45b6d.js"><link rel="prefetch" href="/trainingdays/assets/js/62.c3ecf647.js"><link rel="prefetch" href="/trainingdays/assets/js/63.ad717965.js"><link rel="prefetch" href="/trainingdays/assets/js/64.3e451a8e.js"><link rel="prefetch" href="/trainingdays/assets/js/65.a310d4e8.js"><link rel="prefetch" href="/trainingdays/assets/js/66.91ad5d91.js"><link rel="prefetch" href="/trainingdays/assets/js/67.bdfc270a.js"><link rel="prefetch" href="/trainingdays/assets/js/68.7805630f.js"><link rel="prefetch" href="/trainingdays/assets/js/69.9a6edb47.js"><link rel="prefetch" href="/trainingdays/assets/js/7.3ee5fb68.js"><link rel="prefetch" href="/trainingdays/assets/js/70.2e5214af.js"><link rel="prefetch" href="/trainingdays/assets/js/71.0ed1ea53.js"><link rel="prefetch" href="/trainingdays/assets/js/72.05b27471.js"><link rel="prefetch" href="/trainingdays/assets/js/73.5cd028ca.js"><link rel="prefetch" href="/trainingdays/assets/js/74.cd61fe8d.js"><link rel="prefetch" href="/trainingdays/assets/js/75.8c8f40ca.js"><link rel="prefetch" href="/trainingdays/assets/js/76.50f7afaf.js"><link rel="prefetch" href="/trainingdays/assets/js/77.a0e160e0.js"><link rel="prefetch" href="/trainingdays/assets/js/78.c8465bf5.js"><link rel="prefetch" href="/trainingdays/assets/js/79.458fd2c0.js"><link rel="prefetch" href="/trainingdays/assets/js/8.3f86f0a0.js"><link rel="prefetch" href="/trainingdays/assets/js/80.454f4426.js"><link rel="prefetch" href="/trainingdays/assets/js/81.ed2d010d.js"><link rel="prefetch" href="/trainingdays/assets/js/82.cd4bb1c0.js"><link rel="prefetch" href="/trainingdays/assets/js/83.e3b63896.js"><link rel="prefetch" href="/trainingdays/assets/js/84.af75ea47.js"><link rel="prefetch" href="/trainingdays/assets/js/85.728f265c.js"><link rel="prefetch" href="/trainingdays/assets/js/86.e93b6d39.js"><link rel="prefetch" href="/trainingdays/assets/js/87.d5748615.js"><link rel="prefetch" href="/trainingdays/assets/js/9.b9da79d5.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.8d7a09fd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" aria-current="page" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 DevOps and Monitoring</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="challenge-7-optional-vm-and-custom-script-extensions-post-deployment-automation-or-configure-setup-install-something-within-an-empty-vm"><a href="#challenge-7-optional-vm-and-custom-script-extensions-post-deployment-automation-or-configure-setup-install-something-within-an-empty-vm" class="header-anchor">#</a> Challenge 7 (optional): VM and Custom Script Extensions - Post deployment automation  or configure / setup / install something within an empty vm</h1> <h2 id="here-is-what-you-will-learn-🎯"><a href="#here-is-what-you-will-learn-🎯" class="header-anchor">#</a> Here is what you will learn 🎯</h2> <ul><li>How to automate the further configuration / setup of an '<em>empty</em>' VM after it has been deployed.</li> <li>Use a Custom Script Extension for a Windows VM.</li> <li>Upload automation code into a storage account for anonymous download (so that the CSE agent can download)</li> <li>Modify an ARM Template to enable '<em>zero touch VM deployments</em>'</li></ul> <h2 id="table-of-contents"><a href="#table-of-contents" class="header-anchor">#</a> Table Of Contents</h2> <ol><li><a href="#do-you-need-a-vm">Do you need a VM?</a></li> <li><a href="#attach-a-simple-helloworld-custom-script-extension-cse-to-a-vm-using-the-portal">Attach a simple HelloWorld Custom Script Extension (CSE) to a VM using the Portal</a></li> <li><a href="#see-what-has-happened-inside-the-vm">See what has happened inside the VM</a></li> <li><a href="#attaching-a-cse-to-a-vm-in-an-arm-template-optional">Attaching a CSE to a VM in an ARM Template (optional)</a></li> <li><a href="#cleanup">Cleanup</a></li></ol> <h2 id="do-you-need-a-vm"><a href="#do-you-need-a-vm" class="header-anchor">#</a> Do you need a VM?</h2> <p>For this lab you need an Azure virtual machine that runs Windows Server and some storage accessible to hold your automation code.<br>
Just <strong>click</strong> <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fazuredevcollege%2Ftrainingdays%2Fmaster%2Fday1%2Fchallenge-07%2Fchallengestart%2Fchallengestart.json"><img src="/trainingdays/assets/img/deploytoazure.e0e5d477.png"></a> to spin up a new VM for this lab.</p> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Resource group</em></td> <td>e.g. rg-www-test-001</td></tr> <tr><td><em>Location</em></td> <td>e.g. North Europe</td></tr> <tr><td><em>Admin user</em></td> <td>demoadmin</td></tr> <tr><td><em>Admin password</em></td> <td>%complex enough%</td></tr> <tr><td><em>Vm Size</em></td> <td>e.g.  Standard_F2s_v2</td></tr> <tr><td><em>Disk Sku</em></td> <td>StandardSSD_LRS</td></tr></tbody></table> <h2 id="attach-a-simple-helloworld-custom-script-extension-cse-to-a-vm-using-the-portal"><a href="#attach-a-simple-helloworld-custom-script-extension-cse-to-a-vm-using-the-portal" class="header-anchor">#</a> Attach a simple HelloWorld Custom Script Extension (CSE) to a VM using the Portal</h2> <ul><li><p>Take the following code and copy &amp; paste it into a file named e.g. '<em>HelloWorld.ps1</em>':</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token comment">##############################################</span>
<span class="token comment">#   HelloWorld Custom Script Extension (CSE)</span>
<span class="token comment">##############################################</span>

<span class="token variable">$filePath</span> = <span class="token string">&quot;c:\temp\CSEwasRunAt.txt&quot;</span>

<span class="token comment">#create dir if it doesn't exist</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>Path <span class="token punctuation">(</span><span class="token function">Split-Path</span> <span class="token variable">$filePath</span> <span class="token operator">-</span>Parent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>mkdir <span class="token punctuation">(</span><span class="token function">Split-Path</span> <span class="token variable">$filePath</span> <span class="token operator">-</span>Parent<span class="token punctuation">)</span><span class="token punctuation">}</span>

<span class="token comment">#write current time to file.</span>
<span class="token function">Get-Date</span> <span class="token punctuation">|</span> <span class="token function">Out-File</span> <span class="token variable">$filePath</span> <span class="token operator">-</span>Append

<span class="token comment">#This is really simple but imagine what else you can do to customize a vm ...</span>

</code></pre></div></li> <li><p>Upload this file to a storage account</p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Resource Group 
-&gt; rg-www-test... 
-&gt; sawww... (_your storage account_)  
-&gt; containers 
-&gt; 'csescripts' 
-&gt; Upload  
-&gt;File &quot;HelloWorld.ps1&quot; 
-&gt; Upload
</code></pre></div><p><img src="/trainingdays/assets/img/UploadCSEtoContainer.a339b5d5.png" alt="Upload CSE script to storage account"></p></li> <li><p>Make this file being executed by the Custom Script Extension within the the VM:</p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Home 
-&gt; Search 'virtual machines' 
-&gt; 'vmblue'  
-&gt; Extensions 
-&gt; Add 
-&gt; 'Custom Script Extension' 
-&gt; Create
</code></pre></div><table><thead><tr><th>Parameter</th> <th>Action</th></tr></thead> <tbody><tr><td><em>Script file (Required)</em></td> <td>Browse to your '<em>HelloWorld.ps1</em>' -&gt; it is in your storage account 'sawww...' -&gt; csescripts</td></tr> <tr><td><em>Arguments (Optional)</em></td> <td>none</td></tr></tbody></table></li> <li><p>Wait some seconds then do a refresh of your browser - it'll show the progress:</p> <p><img src="/trainingdays/assets/img/AddCSE-HelloWorldToVM2.0e40b952.png" alt="Reload the page"></p></li> <li><p>Final result should show a success:</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAxwAAAAxCAYAAABQ3a99AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAy7SURBVHhe7ZtNr2XFdYb5R/wL+AkwiKLMiCxPoogfEJxkyBxseRLCmIEdxUjMUGIsHBiC7BkSkhWYMr3W09yXfnt17bNv33O2+348j1Q6u6rWWrXWqo996vTtV65EREREREQOwguHiIiIiIgchhcOERERERE5DC8cIiIiIiJyGF44RERERETkMLxwiIiIiIjIYexeOL7//79YLBaLxWKxWCwWy3PlJvgvHCIiIiIichheOERERERE5DC8cIiIiIiIyGF44RARERERkcPwwiEiIiIiIofhhUNERERERA7DC4eIiIiIiByGFw4RERERETkMLxwiIiIiInIYXjhEREREROQwvHCIiIiIiMhheOEQEREREZHDuNiF44cffrh66623rl555ZWfygcffHDde/fB10v4jh55IB+35dNPP33GF8o777xz3fvyuUSMDwHm5PXXX7/67rvvrlueJfPIJyCHfOp3id6/L7L251o9lY+Hgmfdj1ziHLjrZ91tYP2Tl719QP7u4llwNMxvz/fRZwbj7a2pr7766uq111578nkJLm3vIcFcv/nmm7fOzbn68vK4yIWDiX/11VefeXHxEnrvvffO/lLKQXHbF+JNmQcSPn/00UfXtWNZbR5eQrd5kZOnvYNVLge5fuONN5brk7nLl9L78KVirh3WI+vy1BcB5OeXBWK9y/HeJK5TeNbdnlXuH9pZh197X6KJmX7yTnlsX57mOuf5MfxQIT/CPJ+z5s/Vfyz8+c9/uvr1r3559fHv/vu65Sl/+Oyzq1+9/96Tzwny6KF/ac6+cDD5HBZHfck4+iWcL4Yv60vSavM8tJfwQ4Vcc+FYzRVzyLxSXtbaehHmPlt9OWyQvc0afdnsxXUKz7rzWOX+IZ112RNffPHF7hrLWnqMX7TnOmfu3377bb9APhJY7+yP2873ufqPhbf/+Z+u/uHv/+5J+b8//vG69cf8pZ3S5w9yaUf/0px94bjJC2P1opkvDJ7zT6zY+/777598po1fFbPAsMNBnb4+tPNS5ZejyGA77dMW0N++rGj/Ml5i57CknXrnI2N+/PHHP40dOcAHfEl79LZy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" alt="Result"></p></li></ul> <h2 id="see-what-has-happened-inside-the-vm"><a href="#see-what-has-happened-inside-the-vm" class="header-anchor">#</a> See what has happened inside the VM</h2> <p>Now we RDP into the VM and see what has happened and where to find logs in case something breaks.</p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Resource Groups 
-&gt; 'rg-www...' 
-&gt; 'vmblue' 
-&gt; Connect 
-&gt; Download RDP file 
-&gt; Open 
-&gt; Connect
</code></pre></div><table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>User</em></td> <td>demouser</td></tr> <tr><td><em>Password</em></td> <td>%Your Password%</td></tr></tbody></table> <p>Within the VM:</p> <ol><li>Navigate to <code>C:\temp</code>. The result should look similar to this:</li></ol> <p><img src="/trainingdays/assets/img/AddCSE-HelloWorldToVM4Result.a9275f45.png" alt="CSE Result"></p> <ol start="2"><li>Navigate to <code>C:\Packages\Plugins\Microsoft.Compute.CustomScriptExtension\ _%version%_\Downloads</code>. The CSE is software that runs within the VM. The script that will be executed is downloaded first to this location. If you don't see your script file CSE might have trouble to download the resource.</li></ol> <p><img src="/trainingdays/assets/img/AddCSE-HelloWorldToVM5DownloadFolder.0ef95226.png" alt="CSE Download Folder"></p> <ol start="3"><li>Navigate to <code>C:\WindowsAzure\Logs\Plugins\Microsoft.Compute.CustomScriptExtension\ _%version%_</code> This is the place where the CSE logs its actions locally - a good place to start troubleshooting.</li></ol> <p><img src="/trainingdays/assets/img/AddCSE-HelloWorldToVM6LogsFolder.6dda7ef1.png" alt="CSE Logs Folder"></p> <ol start="4"><li>Remove the CSE from the VM</li></ol> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Home 
-&gt; Search 'virtual machines' 
-&gt; 'vmblue' 
-&gt; 'Custom Script Extension' 
-&gt; 'Uninstall'
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>📝You can only have one Custom Script Extension attached to a VM at a time. If you want to process multiple CSE scripts you need to: <code>Install CSE ('Script1') -&gt; deinstall CSE -&gt; Install CSE ('Script2') -&gt; deinstall -&gt;...</code></p></div> <h2 id="attaching-a-cse-to-a-vm-in-an-arm-template-optional"><a href="#attaching-a-cse-to-a-vm-in-an-arm-template-optional" class="header-anchor">#</a> Attaching a CSE to a VM in an ARM Template (optional)</h2> <p>The goal of this action is to learn how to avoid the portal, i.e. so that the CSE can be attached to a VM during deployment time e.g. using an ARM template. With the whole setup Azure + VM Settings can be done in a '<em>0 touch way</em>'.</p> <ol><li><p>In the next CSE we want to install Internet Information Services (IIS) in the VM. Take a look at the code file first (&quot;<a href="https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-07/scripts/CSE_Install-IIS.ps1" target="_blank" rel="noopener noreferrer">CSE_Install-IIS.ps1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>&quot;). The relevant parts starts at <em>#region install IIS features</em>.</p></li> <li><p>When automating CSE e.g. through ARM deployment - the CSE needs a valid download location for the code file (<code>CSE_Install-IIS.ps1</code>). This could be e.g. a public github repo or another https-reachable location. In this lab we use a storage account for this. Upload (&quot;<a href="https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-07/scripts/CSE_Install-IIS.ps1" target="_blank" rel="noopener noreferrer">CSE_Install-IIS.ps1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>&quot;) file to a storage account.</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] -&gt; Resource Group -&gt; rg-www -&gt; sawww... (%your storage account%)  -&gt; containers -&gt; 'csescripts' -&gt; Upload -&gt;File &quot;CSE_Install-IIS.ps1&quot; -&gt; Upload
</code></pre></div><ol start="3"><li>Edit the CSE ARM template to use the correct scripts location. Once uploaded you can copy the blobs URL from the Azure portal</li></ol> <p><img src="/trainingdays/assets/img/saUploadCSE2.b3e7ae7c.png" alt="Copy the URL of the IIS install script"></p> <blockquote><p>❔ <strong>Question</strong> Can you download the file in your browser using the URL? If not have you set the correct access level at the container?</p></blockquote> <p>Edit this: <a href="https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-07/scripts/ARMCSE.json" target="_blank" rel="noopener noreferrer">CSE ARM template<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> template to use the scripts location:</p> <p><img src="/trainingdays/assets/img/ModifyARM.059cd7f7.png" alt="Edit following ARM section"></p> <p>with your value</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token string">&quot;fileUris&quot;</span>: <span class="token punctuation">[</span>
  <span class="token string">&quot;https://sawww....blob.core.windows.net/cse/CSE_Install-IIS.ps1&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>Copy the template into the clipboard.</p> <ol start="4"><li>Deploy the ARM Template.</li></ol> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Resource Groups 
-&gt; 'rg-www' -&gt; '+' 
-&gt; Template deployment 
-&gt; &quot;Build your own template in the editor&quot; 
-&gt; Paste the clipboard
</code></pre></div><p>Select the right resource group and VM and deploy:</p> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Resource group</em></td> <td>e.g. rg-www-test-001</td></tr> <tr><td><em>Region</em></td> <td>e.g. North Europe</td></tr> <tr><td><em>VM name</em></td> <td>vmblue</td></tr></tbody></table> <p>Deployment will take some minutes: A role is installed and an IIS feature is downloaded and installed.</p> <ol start="5"><li>At the end the result should look like this:</li></ol> <p><img src="/trainingdays/assets/img/CSE-Deployment.887c14a6.png" alt="CSE deployment"></p> <p>Now you have a web server in your VM - you should test by browsing to the public IP address:</p> <p><img src="/trainingdays/assets/img/CSEIIS-Success.4d031f79.png" alt="Running IIS"></p> <h2 id="cleanup"><a href="#cleanup" class="header-anchor">#</a> Cleanup</h2> <p>Cleanup by deleting the resource group.</p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] 
-&gt; Resource Groups 
-&gt; 'rg-www' 
-&gt; 'Delete resource group'
</code></pre></div><p><a href="/trainingdays/day1/challenge-06/">◀ Previous challenge</a> | <a href="/trainingdays/day1/" class="router-link-active">🔼 Day 1</a> | <a href="/trainingdays/day1/challenge-08/">Next challenge ▶</a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day1/challenge-07/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.e8a6fdbf.js" defer></script><script src="/trainingdays/assets/js/3.9b3cf7d1.js" defer></script><script src="/trainingdays/assets/js/16.bf550880.js" defer></script>
  </body>
</html>
